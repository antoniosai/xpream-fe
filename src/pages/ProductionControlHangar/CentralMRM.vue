<style scoped>

    ::v-deep .line-numbers{
        min-width:40px !important;
        max-width:40px !important;
        height:50px;
    }

    ::v-deep .vgt-checkbox-col{
        min-width:30px !important;
        max-width:30px !important;
        height:50px;
    }

    ::v-deep .matnr-gadc {
        min-width: 185px !important;
        max-width: 185px !important;
        white-space: nowrap; 
        overflow: auto; 
    }

    ::v-deep .maktx-gadc {
        min-width: 200px !important;
        max-width: 200px !important;
        white-space: nowrap; 
        overflow: auto; 
    }

    ::v-deep .mtart-gadc {
        min-width: 60px !important;
        max-width: 60px !important;
    }

    ::v-deep .bdmng-gadc {
        min-width: 65px !important;
        max-width: 65px !important;
    }

    ::v-deep .qtydel-gadc {
        min-width: 85px !important;
        max-width: 85px !important;
    }

    ::v-deep .meins-gadc {
        min-width: 65px !important;
        max-width: 65px !important;
    }

    ::v-deep .flcstat-gadc {
        min-width: 100px !important;
        max-width: 100px !important;
    }

    ::v-deep .line-gadc {
        min-width: 120px !important;
        max-width: 120px !important;
    }

    ::v-deep .ac-gadc {
        min-width: 90px !important;
        max-width: 90px !important;
    }

    ::v-deep .aufnr-gadc {
        min-width: 90px !important;
        max-width: 90px !important;
    }

    ::v-deep .sto-gadc {
        min-width: 120px !important;
        max-width: 120px !important;
    }

    ::v-deep .dn-gadc {
        min-width: 120px !important;
        max-width: 120px !important;
    }

    ::v-deep .to-gadc {
        min-width: 120px !important;
        max-width: 120px !important;
    }

    ::v-deep .loc-gadc {
        min-width: 100px !important;
        max-width: 100px !important;
    }

    ::v-deep .expstat-gadc {
        min-width: 100px !important;
        max-width: 100px !important;
    }

    ::v-deep .exprec-gadc {
        min-width: 150px !important;
        max-width: 150px !important;
    }

    ::v-deep .exprem-gadc {
        min-width: 300px !important;
        max-width: 300px !important;
    }

    ::v-deep .gahstat-gadc {
        min-width: 125px !important;
        max-width: 125px !important;
    }

    ::v-deep .gahship-gadc {
        min-width: 150px !important;
        max-width: 150px !important;
    }

    ::v-deep .gahrem-gadc {
        min-width: 300px !important;
        max-width: 300px !important;
    }

    ::v-deep .storestat-gadc {
        min-width: 150px !important;
        max-width: 150px !important;
    }

    ::v-deep .storerem-gadc {
        min-width: 300px !important;
        max-width: 300px !important;
    }

    ::v-deep .cdate{
        min-width:185px !important;
        max-width:185px !important;
    }

    ::v-deep  .vgt-left-align {
        white-space: normal !important;
    }

    ::v-deep .table.vgt-table{
        font-size: 9px !important; 
        border-collapse: collapse !important;
        background-color: #fff !important;
        width: 100% !important;
        max-width: 100% !important;
        table-layout: auto !important;
        border: 1px solid #dcdfe6 !important;
    }

    ::v-deep .vgt-table.bordered td, .vgt-table.bordered th {
        border: 1px solid #dcdfe6  !important;
        height: 20px  !important;
        font-size: 9pt  !important;
    }

    ::v-deep .vgt-wrap__footer {
        font-size: 9pt !important;
        /* color: #606266; */
        padding: 0.5em !important;
        height: 35px !important;
        border: 1px solid #dcdfe6 !important;
        background: #ffffff !important;
    }


    ::v-deep .vgt-wrap__footer .footer__row-count__label {
        font-size: 9pt !important;
        color: #909399 !important;
    }

    ::v-deep .vgt-wrap__footer .footer__navigation__page-btn.disabled, .vgt-wrap__footer .footer__navigation__page-btn.disabled:hover {
        opacity: .5 !important;
        cursor: not-allowed !important;
        box-shadow: 0 0 black !important;
        font-size: 9pt !important;
    }

    ::v-deep .vgt-wrap__footer .footer__navigation__info, .vgt-wrap__footer .footer__navigation__page-info {
        display: inline-block !important;
        color: #909399 !important;
        margin: 0 16px !important;
        font-size: 9pt !important;
    }

    ::v-deep .vgt-wrap__footer .footer__navigation__page-btn {
        text-decoration: none !important;
        color: #606266 !important;
        font-weight: 700 !important;
        white-space: nowrap !important;
        font-size: 9pt !important;
    }

    ::v-deep .vgt-global-search__input .input__icon .magnifying-glass {
        margin-top: 8px !important;
        margin-left: 10px !important;
        display: block !important;
        width: 12px !important;
        height: 12px !important;
        border: 2px solid #d6dae2 !important;
        position: relative !important;
        border-radius: 50% !important;
    }

    ::v-deep .vgt-input, .vgt-select{
        font-size: 9pt !important;
    }

    ::v-deep .footer__row-count__label {
        margin-top: -7px !important;
    }

    ::v-deep .footer__navigation{
        margin-top: -2px !important;
    }

    ::v-deep .vgt-wrap__footer .footer__row-count__select {
        margin-top: -5px !important;
        width: 50px !important;
        padding: 0px 15px 0px 5px;
        border: 0px  !important;
        border-radius: 0px !important;
        color: #606266 !important;
        font-weight: 700 !important;
        font-size: 9pt !important;
        margin-left: 0px !important;
        height: 32px !important;
        line-height: 32px !important;
    }

    ::v-deep .vgt-wrap__footer .footer__navigation__page-info__current-entry {
        width: 50px !important;
        text-align: center !important;
        display: inline-block !important;
        margin: 0 10px !important;
        font-weight: 700 !important;
        height: 25px !important;
    }

    ::v-deep .vgt-global-search {
        background: #ffffff !important;
        border: 1px solid #dcdfe6  !important;
    }

    ::v-deep .vgt-table thead th {
        background: #ffffff !important;
        width:null;
    }

    ::v-deep .tooltip-x {
        position: relative !important;
        display: inline-block !important;
    }

    ::v-deep .tooltip-x .tooltiptext-x {
        visibility: hidden !important;
        width: 120px !important;
        background-color: black !important;
        color: #fff !important;
        text-align: center !important;
        border-radius: 6px !important;
        padding: 5px 0 !important;
        
        /* Position the tooltip */
        position: absolute !important;
        z-index: 1 !important;
        bottom: 100% !important;
        left: 50% !important;
        margin-left: -60px !important;
        white-space: nowrap !important;
    }

    ::v-deep .tooltip-x:hover .tooltiptext-x {
        visibility: visible !important;
    }

        ::v-deep .status-handler {
        color: white !important;
        font-size: 9pt;
        border-radius: 5px;
        padding: 4px !important;
    }

    ::v-deep .status-handler.success {
        background-color: #13CE66;

    }

    ::v-deep .status-handler.primary {
        background-color: #026396;

    }

    ::v-deep .status-handler.danger {
        background-color: #dc3545;
    }

    ::v-deep .status-handler.warning {
        background-color: #ffc107;
    }

    /* Layout */
    ::v-deep .flip-list-move {
      transition: transform 0.5s;
    }
    ::v-deep .no-move {
      transition: transform 0s;
    }
    ::v-deep .ghost {
      opacity: 0.5;
      background: #c8ebfb;
    }
    ::v-deep .list-group {
      min-height: 20px;
    }
    ::v-deep .list-group-item {
      cursor: move;
    }
    ::v-deep .list-group-item i {
      cursor: pointer;
    }

    ::v-deep .list-group-item:last-child {
        margin-bottom: 0 !important;
        border-bottom-right-radius: 0px !important;
        border-bottom-left-radius: 0px !important;
    }

    ::v-deep .list-group-item:first-child {
        border-top-right-radius: 0px !important;
        border-top-left-radius: 0px !important;
    }
    /* / Layout */


</style>

<template>
    <div v-show="hasAccess">
        <div class="content-header"></div>
        <div class="content-body" style="padding-top:40px;">
            <ul class="tab-menu">
                <li class="tab-link" data-tab="dashboard" v-on:click="$router.push({name: 'pc_hangar.gadcdashboard'})">Dashboard</li>
                <li class="tab-link active" data-tab="mrm">GADC Request Monitoring</li>
            </ul>
            <div class="card tab-content active" id="mdr" style="border-radius: 0px 8px 8px 8px;">
                <div class="card-header">
                    <div class="title-area">
                        <h3 class="title">GADC Request Monitoring</h3>
                    </div>
                    <div class="option-box">
                        <div class="option-item">
                            <span style="white-space: nowrap">Location</span>
                            <select v-model="datatable.serverParams.filter.location">
                                <option value="all">All Location</option>
                                <option v-for="hangar in hangars" :key="hangar.ID"  :value="hangar.id" >{{hangar.name + ' - ' + hangar.description}}</option>
                            </select>
                        </div>                        
                        <div class="option-item">
                            <span style="white-space: nowrap"><b>A/C Reg</b></span>
                            <multiselect 
                                v-model="datatable.serverParams.filter.ac_regs" 
                                tag-placeholder="Add this as new tag" 
                                placeholder="Type and enter" 
                                :options="options_ac" 
                                :multiple="true" 
                                :taggable="true"
                                label="ac_reg"
                                track-by="ac_reg"
                                @tag="addTag"
                                style="min-width: 250px; padding-left: 10px;"
                            >
                            <!-- <template slot="option" slot-scope="props">{{props.option.ac_reg}}</template> -->
                            </multiselect>
                        </div>
                        <div class="option-item">
                            <button v-on:click="loadItems()">
                                <i class="material-icons">filter_list</i>
                                Filter
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-content">
                    <div  style="box-sizing: border-box; position: relative; min-height: 20px;">
                        <div>
                            <loading style="margin-top: 50px;"
                                :active.sync="loading.isLoading" 
                                :can-cancel="false"
                                :is-full-page="false"
                                :color="loading.color"
                                :loader="loading.loaderType">
                            </loading>
                            <template>
                                <div v-show="renderedFields">
                                    <vue-good-table
                                        ref="table-gadc-tracking"
                                        :columns="datatable.fields"
                                        :rows="datatable.rows"  
                                        :fixed-header="true"
                                        styleClass="vgt-table bordered"
                                        max-height="100vh"
                                        :line-numbers="true"
                                        :search-options="{
                                            enabled: true,
                                            trigger: 'keyup',
                                            skipDiacritics: true,
                                            placeholder: 'Fill and enter to search',
                                            
                                        }"
                                        :select-options="{ 
                                            enabled: grant_access,
                                            selectOnCheckboxOnly: true
                                        }"                                    
                                        @on-selected-rows-change="selectionChanged"
                                        :pagination-options="{
                                            enabled: true,
                                            mode: 'pages',
                                            perPage: datatable.serverParams.perPage,
                                            position: 'bottom',
                                            perPageDropdown:  datatable.perPageDropDown,
                                            dropdownAllowAll: true,
                                            setCurrentPage: datatable.serverParams.page,
                                            nextLabel: 'Next',
                                            prevLabel: 'Prev',
                                            rowsPerPageLabel: 'Rows per page',
                                            ofLabel: 'of',
                                            pageLabel: 'page',
                                            allLabel: 'All',
                                        }"
                                    >
                                         <template slot="table-row" slot-scope="props">
                                        
                                            <span v-if="props.column.field == 'FLC_STATUS'">
                                                <select 
                                                    v-model="props.formattedRow[props.column.field]" 
                                                    v-bind:class="handlerClassStatus(props.formattedRow[props.column.field])" 
                                                    :disabled="!grant_access" :id="'gadc-flc-status-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'FLC_STATUS', 'gadc-flc-status-' +props.index)"
                                                    style="font-size: unset;  padding: 0px 10px 0px 10px  !important;">
                                                >
                                                    <option :value="null">Select Option</option>
                                                    <option value="NORMAL">NORMAL</option>
                                                    <option value="URGENT">URGENT</option>
                                                </select>
                                            </span>
                                            <span v-else-if="props.column.field == 'ALTERNATEPN'">
                                                <input 
                                                    :disabled="!grant_access" 
                                                    :value="props.formattedRow[props.column.field]" 
                                                    :id="'gadc-alternate-number-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'ALTERNATEPN', 'gadc-alternate-number-' +props.index)"
                                                    type="text"
                                                >
                                            </span>
                                            <span v-else-if="props.column.field == 'PART_LOCATION'">
                                                <input 
                                                    :disabled="!grant_access" 
                                                    :value="props.formattedRow[props.column.field]" 
                                                    :id="'gadc-loc-number-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'PART_LOCATION', 'gadc-loc-number-' +props.index)"
                                                    type="text"
                                                >
                                            </span>                                                                                         
                                            <span v-else-if="props.column.field == 'STO_NUMBER'">
                                                <input 
                                                    :disabled="!grant_access" 
                                                    :value="props.formattedRow[props.column.field]" 
                                                    :id="'gadc-sto-number-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'STO_NUMBER', 'gadc-sto-number-' +props.index)"
                                                    type="text"
                                                >
                                            </span>
                                            <span v-else-if="props.column.field == 'DN'">
                                                <input 
                                                    :disabled="!grant_access" 
                                                    :value="props.formattedRow[props.column.field]" 
                                                    :id="'gadc-dn-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'DN', 'gadc-dn-' +props.index)" 
                                                    type="text"
                                                >
                                            </span>
                                            <span v-else-if="props.column.field == 'TO'">
                                                <input 
                                                    :disabled="!grant_access" 
                                                    :value="props.formattedRow[props.column.field]" 
                                                    :id="'gadc-to-number-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'TO', 'gadc-to-number-' +props.index)" 
                                                    type="text"
                                                >
                                            </span>
                                            <span v-else-if="props.column.field == 'SUMMARYSTAT'" :class="handlerClassSummaryStatus(props.formattedRow[props.column.field])">
                                                {{props.formattedRow[props.column.field]}}
                                            </span>                                            
                                            <span v-else-if="props.column.field == 'EXP_STATUS'">
                                                <select 
                                                    v-model="props.formattedRow[props.column.field]" 
                                                    :disabled="!exp_access && !grant_access" :id="'gadc-exp-status-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'EXP_STATUS', 'gadc-exp-status-' +props.index)"
                                                    style="font-size: unset;  padding: 0px 10px 0px 10px  !important;"
                                                    :class="handlerClassExpStatus(props.formattedRow[props.column.field])" 

                                                >
                                                    <option :value="null">Select Option</option>
                                                    <option value="OPEN">OPEN</option>
                                                    <option value="PICKED">PICKED</option>
                                                    <option value="GOODS ISSUE">GOODS ISSUE</option>
                                                    <option value="NIL STOCK">NIL STOCK</option>
                                                    <option value="XDOC">XDOC</option>
                                                    <option value="DN PROBLEM">DN PROBLEM</option>
                                                </select>
                                            </span>
                                            <span v-else-if="props.column.field == 'EXP_QTY'">
                                                <input 
                                                    :disabled="!exp_access && !grant_access" 
                                                    :value="props.formattedRow[props.column.field]" 
                                                    :id="'gadc-exp-qty-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'EXP_QTY', 'gadc-exp-qty-' +props.index)" 
                                                    type="number"
                                                >
                                            </span>                                            
                                            <span v-else-if="props.column.field == 'EXP_RECEIVER'">
                                                <input 
                                                    :disabled="!exp_access && !grant_access" 
                                                    :value="props.formattedRow[props.column.field]" 
                                                    :id="'gadc-exp-receiver-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'EXP_RECEIVER', 'gadc-exp-receiver-' +props.index)" 
                                                    type="text"
                                                >
                                            </span>
                                            <span v-else-if="props.column.field == 'EXP_REMARK'">
                                                <input 
                                                    :disabled="!exp_access && !grant_access" 
                                                    :value="props.formattedRow[props.column.field]" 
                                                    :id="'gadc-exp-remarks-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'EXP_REMARK', 'gadc-exp-remarks-' +props.index)" 
                                                    type="text"
                                                >
                                            </span>
                                            <span v-else-if="props.column.field == 'GAH_STATUS'">
                                                <select 
                                                    v-model="props.formattedRow[props.column.field]" 
                                                    :disabled="!gah_access && !grant_access" :id="'gadc-gah-status-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'GAH_STATUS', 'gadc-gah-status-' +props.index)"
                                                    style="font-size: unset;  padding: 0px 10px 0px 10px  !important;"
                                                    :class="handlerClassGAHStatus(props.formattedRow[props.column.field])" 
                                                >
                                                    <option :value="null">Select Option</option>
                                                    <option value="GOODS RECEIPT">GOODS RECEIPT</option>
                                                    <option value="TO CONFIRMED">TO CONFIRMED</option>
                                                    <option value="TO FOR DIFFERENT ORDER">TO FOR DIFFERENT ORDER</option>
                                                </select>
                                            </span>
                                            <span v-else-if="props.column.field == 'GAH_REMARK'">
                                                <input 
                                                    :disabled="!gah_access && !grant_access" 
                                                    :value="props.formattedRow[props.column.field]" 
                                                    :id="'gadc-gah-remark-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'GAH_REMARK', 'gadc-gah-remark-' +props.index)" 
                                                    type="text"
                                                >
                                            </span>
                                            <span v-else-if="props.column.field == 'BDMNG'">
                                                <span v-if="props.formattedRow[props.column.field] === null">0</span>
                                                <span v-else>{{parseFloat(props.formattedRow[props.column.field]).toFixed(2)}}</span>
                                            </span>                                            

                                            <!-- <span v-else-if="props.column.field == 'STORE_STATUS'">
                                                <select v-model="datatable.rows[props.index].STORE_STATUS" :disabled="!grant_access" :id="'gadc-store-status-' +props.index" v-on:change="handlerUpdateData(props.formattedRow['ID'], 'STORE_STATUS', 'gadc-store-status-' +props.index)">
                                                    <option value="">Select Option</option>
                                                </select>
                                            </span> -->
                                            <!-- <span v-else-if="props.column.field == 'STORE_REMARK'">
                                                <input 
                                                    :disabled="!grant_access" 
                                                    :value="props.formattedRow[props.column.field]" 
                                                    :id="'gadc-store-remark-' +props.index" 
                                                    v-on:change="handlerUpdateData(props.formattedRow['ID'], 'STORE_REMARK', 'gadc-store-remark-' +props.index)" 
                                                    type="text"
                                                >
                                            </span> -->
                                            <span v-else-if="props.column.field == 'action'">
                                                <span v-if="props.formattedRow['STORE_STATUS'] == 'addgadc'">
                                                    <div class="action tooltip-x" style="text-align: center; width: 100%;">
                                                        <span class="tooltiptext-x">Delete Item</span>
                                                        <i v-if="!grant_access" style="font-size: 10pt; font-weight: bold;" class="material-icons default">delete</i>
                                                        <i v-else v-on:click="handlerDeleteItem(props.formattedRow['ID'])" style="font-size: 10pt; font-weight: bold;" class="material-icons danger">delete</i>
                                                    </div>
                                                </span>
                                            </span>                                            
                                             <span v-else>
                                                <div class="flex-middle-default">
                                                    {{props.formattedRow[props.column.field]}}
                                                </div>
                                            </span>

                                         </template>
                                        <div slot="table-actions">
                                            <div class="toolbar toolbar-default">
                                                <div class="toolbar-item" style="margin-right: -10px;">
                                                    <div v-on:click="handlerExportData()" class="single-button synchronize display-flex align-items-center justify-center tooltip-x" style="background:#ffc107; margin-right: -2px; margin-left: -3px; padding-top: 6px;" tabindex="0">
                                                        <span class="tooltiptext-x">Export Excel</span>
                                                        <i class="material-icons warning sync_order" >file_download</i>
                                                    </div>
                                                </div>                                                
                                                <div class="toolbar-item" style="margin-right: -10px;">
                                                    <button v-on:click="initData()" class="button is-primary">
                                                        <i class='material-icons'>
                                                            sync
                                                        </i>
                                                        Refresh
                                                    </button>
                                                </div>
                                                 <div class="toolbar-item" style="margin-right: -8px;">
                                                    <button :disabled="!grant_access" v-on:click="(grant_access) ? handlerModalSingleAdd() : ''" class="button is-default">
                                                        <i class='material-icons'>
                                                            add_circle
                                                        </i>
                                                        Add
                                                    </button>
                                                </div>                                                
                                                <div class="toolbar-item" style="margin-right: 10px;">
                                                    <button v-on:click="handlerlayout()" class="button is-success">
                                                        <i class='material-icons'>
                                                            grid_on
                                                        </i>
                                                        Layout
                                                    </button>
                                                </div> 
                                            </div>
                                        </div>
                                    </vue-good-table>

                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                <!-- modal layout -->
                <div class="modal-box" id="modal-layout" data-keyboard="false" data-backdrop="static">
                    <div class="modal sm">
                        <span class="close" v-on:click="hideModal('modal-layout')"></span>
                            <div class="modal-header">
                                <h2 class="title">Arrange Table Layout</h2>
                            </div>
                            <div class="modal-body" style="position: relative; height:500px; overflow-y:auto;">
                                <draggable 
                                    :list="datatable.fields"
                                    class="list-group"
                                    ghost-class="ghost"
                                    v-bind="dragOptions"
                                    @start="drag = true"
                                    @end="drag = false"
                                    @change="handlerDateColumns"
                                >
                                <transition-group type="transition" :name="!drag ? 'flip-list' : null">
                                    <div v-for="(element, index) in datatable.fields" :key="index + 0">
                                        <div class="list-group-item" v-if="element.label !== 'ID'">
                                            <i :class="element.fixed ? 'fa fa-anchor' : 'glyphicon glyphicon-pushpin'" @click="element.fixed = !element.fixed" aria-hidden="true"></i>
                                            <div class="is-row" v-if="element.hidden==false" style="font-weight:bold;">
                                                <div class="is-col is-70">
                                                    {{element.label}}
                                                </div>
                                                <div class="is-col is-10">
                                                    <button class="button is-100 is-secondary is-success" style="padding:0px !important;" v-on:click="element.hidden = true">HIDE</button>
                                                </div>
                                            </div>
                                            <div class="is-row" v-else>
                                                <div class="is-col is-70">
                                                {{element.label}}
                                                </div>
                                                <div class="is-col is-10">
                                                    <button class="button is-100 is-default" v-on:click="element.hidden = false">SHOW</button>
                                                </div>                                               
                                            </div>
                                        </div>

                                    </div>
                                </transition-group>
                                </draggable>
                            </div>
                            <div class="modal-footer" style="">
                                <button class="button is-primary is-default cancel" v-on:click="hideModal('modal-layout')">Close</button>
                                <button v-on:click="handlerResetLayout()" class="button is-danger" type="button" id="btn-reset-layout"> Reset Layout </button>
                                <button v-on:click="handlerSaveArrangedLayout()" class="button is-primary" type="button" id="btn-save-layout"> Save Aranged Layout </button>
                            </div>
                    </div>
                </div>
                <!-- /modal layout -->

                <!-- modal single add -->
                <div class="modal-box" id="modal-single-add" data-keyboard="false" data-backdrop="static">
                    <div class="modal lg">
                        <span class="close" v-on:click="hideModal('modal-single-add')"></span>
                            <div class="modal-header">
                                <h2 class="title">Add Single MRM</h2>
                            </div>
                            <div class="modal-body" style="position: relative">
                                <label>
                                    Input data <span class="is-req">*</span>
                                </label>
                                <div class="is-row">
                                    <div class="form-item is-col is-15">
                                        <input v-model="form.revnr" value="" type="text"> 
                                        <div class="is-desc">Revision No</div>
                                    </div>
                                    <div class="form-item is-col is-15">
                                        <input v-model="form.aufnr" value="" type="text"> 
                                        <div class="is-desc">Order No</div>
                                    </div>                                     
                                    <div class="form-item is-col is-20">
                                        <input v-model="form.part_number" value="" type="text"> 
                                        <div class="is-desc">Part Number</div>
                                    </div>
                                    <div class="form-item is-col is-20">
                                        <input v-model="form.mat_desc" value="" type="text"> 
                                        <div class="is-desc">Material Description</div>
                                    </div>
                                    <div class="form-item is-col is-10">
                                        <input v-model="form.mat_type" value="" type="text"> 
                                        <div class="is-desc">Material Type</div>
                                    </div>                                                                        
                                    <div class="form-item is-col is-10">
                                        <input v-model="form.qty_req" value="" type="number"> 
                                        <div class="is-desc">QTY Required</div>
                                    </div>
                                    <div class="form-item is-col is-10">
                                        <input v-model="form.uom" value="" type="text"> 
                                        <div class="is-desc">UOM</div>
                                    </div>                                    
                                </div>
                                <div class="is-row" style="margin-top: -10px;">
                                     <div class="form-item is-col is-30">
                                        <input v-model="form.alternate_pn" value="" type="text"> 
                                        <div class="is-desc">Alternate Part Number</div>
                                    </div>                                                                                     
                                    <div class="form-item is-col is-40">
                                        <input v-model="form.part_location" value="" type="text"> 
                                        <div class="is-desc">Part location</div>
                                    </div>
                                    <div class="form-item is-col is-30">
                                        <input v-model="form.date_provision" value="" type="date"> 
                                        <div class="is-desc">Date of Provision</div>
                                    </div>                                    
                                </div>
                            </div>
                            <div class="modal-footer" style="">
                                <button class="button is-primary is-default cancel" v-on:click="hideModal('modal-single-add')">Close</button>
                                <button v-on:click="handlerSaveSinglMDR()" class="button is-success" type="submit" id="btn-single-add"> Save </button>

                            </div>
                        <!-- </form> -->
                    </div>
                </div>
                <!-- /modal single add  -->


            </div>
        </div>
    </div>
</template>

<script>

import { VueGoodTable } from 'vue-good-table';
import Loading from 'vue-loading-overlay';
import axios from 'axios';
import XLSX from 'xlsx';
import draggable from 'vuedraggable';
import FieldMRMCentral from './Project/datatable/FieldMRMCentral';
import Multiselect from 'vue-multiselect';
import 'vue-multiselect/dist/vue-multiselect.min.css';
import 'vue-loading-overlay/dist/vue-loading.css';
import 'vue-good-table/dist/vue-good-table.css';

export default {

    data: () => ({
        loading: {
            isLoading: false,
            fullPage: false,
            loaderType: 'dots',
            color: '#0065ff',
        },
        datatable: {
            fields: FieldMRMCentral,
            rows: [],
            totalRows: '',
            serverParams: {
                columnFilters: {
                },
                sort: {
                    type: '',
                    field: ''
                },
                page: 1, 
                perPage: 10,
                searchTerm: '',
                filter: {
                    ac_regs: [],
                    location: "all",
                },
                revnr: "",
            },
            perPageDropDown: [10, 50, 100],
            selectedRows: []
        },

        form: {
            aufnr: "",
            part_number: "",
            qty_req: "",
            input_by: "",
            alternate_pn: "",
            mat_desc: "",
            mat_type: "",
            additional_status: "",
            part_location: "",
            request_date: "",
            mat_supply: "",
            uom: "",
            qty_available: "",
            uic: "",
            purchase_order: "",
            date_po: "",
            rws: "",
            eta: "",
            spin: "",
            date_provision: "",
            date_gah: "",
            date_preload: "",
            received_by: "",
            date_recived: "",
            qty_delivered: "",
            qty_installed: "",
            remarks: ""
        },

        grant_access: true,
        drag: false,
        renderedFields: false,
        exp_access: false,
        hasAccess: false,
        options_ac: [],
        hangars: [],
    }),

    components: {
        Loading, 
        VueGoodTable,
        'multiselect': Multiselect,
        draggable,
    },

    mounted() {
        if(
            !this.$bulkCan(
                'pc_hangar_central_flc',
                'pc_hangar_central_flc_view',
                'pc_hangar_central_flc_exp',
                'pc_hangar_central_flc_gah'
            )
        ) {
            this.$router.push({name: 'access_denied'});
        }else {
            this.hasAccess = true;
            this.permissionHandler();
            this.initArangedLayout().then(() => {
                this.renderedFields = true;
                this.handlerArrangedStyle();
                this.initData();
                this.handlerDateColumns();
                this.initfilteracreg();
                this.initHangar();
            });
        }
    },

    computed: {     
        dragOptions() {
          return {
            animation: 200,
            group: "description",
            disabled: false,
            ghostClass: "ghost"
          };
        },
    },

    methods: {
        initData:  function() {
            $( ".vgt-fixed-header, .vgt-responsive" ).wrapAll( "<div class='new' />").css("width","unset").css( "overflow-x","unset");
            $( ".vgt-fixed-header").css("position","sticky").css("position","-webkit-sticky").css("top","0");
            $( ".vgt-fixed-header table thead tr:nth-child(2) th:nth-child(1)").text(".");
            $( ".vgt-responsive thead").attr("hidden",true);
            $( "th").removeAttr("style");
            $( ".new" ).css( "overflow-x","auto"); 

            this.loading.isLoading = true;

            axios.post('/api/production_control_hangar/gadc/get_datatable', this.datatable.serverParams)
            .then(res => {
                if(res.data.length < 1) {
                    toastr.warning(`Empty data`)
                }

                this.datatable.rows = res.data
                this.loading.isLoading = false;

            })
            .catch(e => {
                console.log("Error: "+e)
                toastr.error("Undefined error");
                this.loading.isLoading = false;
            })
        },

        initHangar: function() {
            axios.get('/api/booking_and_submission/show_hangar')
            .then( res => {
                this.hangars = res.data
            })
        },

        handlerClassStatus: function(data) {
            let class_name = "";

            if(data === "NORMAL") class_name = "status-handler success";
            else if(data === "URGENT") class_name = "status-handler danger";

            return class_name;
            
        },

        handlerClassExpStatus: function(data) {
            let class_name = "";

            if(data === "OPEN") class_name = "status-handler primary";
            else if(data === "NIL STOCK" || data === "XDOC" || data === "DN PROBLEM") class_name = "status-handler danger";
            else if(data === "PICKED") class_name = "status-handler warning";
            else class_name = "status-handler success";

            return class_name;
            
        },

        handlerClassSummaryStatus: function(data) {
            let class_name = "";

            if(data === "Need DN/TO") class_name = "status-handler primary";
            else if(data === "Actual Nil Stock" || data === "Part in Xdoc" || data === "Open TO" || data === "Different Order") class_name = "status-handler danger";
            else if(data === "Processed by GADC") class_name = "status-handler warning";
            else class_name = "status-handler success";

            return class_name;
            
        },

        handlerClassGAHStatus: function(data) {
            let class_name = "";
            if(data === "TO FOR DIFFERENT ORDER") class_name = "status-handler danger";
            else if(data === "GOODS RECEIPT") class_name = "status-handler primary";
            else if(data === "TO CONFIRMED") class_name = "status-handler success";
            return class_name;
            
        },

        initfilteracreg: function() {
            axios.get('/api/production_control_hangar/gadc/getacreg_active/all')
            .then(res => {
                this.options_ac = res.data;
            })
            .catch(e => {
                console.log("Error: " + e);
            })
        },
        
        handlerUpdateData: function(id, column, elem) {
            if(!this.grant_access && !this.exp_access && !this.gah_access) return;
            if(this.exp_access && !this.grant_access && column != 'EXP_STATUS' && column != 'EXP_QTY' && column != 'EXP_RECEIVER' && column != 'EXP_REMARK') return;
            if(this.gah_access && !this.grant_access && column != 'GAH_STATUS' && column != 'GAH_REMARK') return;            
            //this.loading.isLoading = true;
            let elm = document.getElementById(elem).value;

            axios.post('/api/production_control_hangar/update_tmrm', {
                id: id,
                column: column,
                data: elm,
            })
            .then(res => {
                if(res.data.success) {
                    toastr.success(res.data.message);
                    toastr.info('refreshing data ...');

                    axios.post('/api/production_control_hangar/gadc/get_datatable', this.datatable.serverParams)
                    .then(res => {
                        this.datatable.rows = res.data
                        toastr.remove();
                        toastr.success('data refreshed');
                    })
                    .catch(e => {
                        console.log("Error: "+e);
                        toastr.remove();
                        toastr.error("Undefined error");
                    })
                }else {
                    toastr.remove();
                    toastr.error(res.data.message);
                }
                this.loading.isLoading = false;
            })
            .catch(e => {
                console.log("Error: " + e);
                toastr.error("Undefined error");
                this.loading.isLoading = false;

            }) 
        },

        handlerlayout: function() {
            $('#modal-layout').modal('show');

        },

        handlerModalSingleAdd: function() {
            this.form.revnr = "";
            this.form.aufnr = "";
            this.form.part_number = "";
            this.form.qty_req = "";
            this.form.alternate_pn = "";
            this.form.mat_desc = "";
            this.form.mat_type = "";
            this.form.part_location = "";
            this.form.uom = "";
            this.form.date_provision = "";

            $('#modal-single-add').modal('show');

        },

        hideModal: function(modal_name) {
            $('#' + modal_name).modal('hide');
        },

        handlerSaveSinglMDR: function() {
            this.handleButton('btn-single-add', 'load').then(() => {

                axios.post('/api/production_control_hangar/add_tmrmgadc', this.form)
                .then(res => {
                    if(res.data.success) {
                        toastr.success(res.data.message, 'Success')
                        this.initData();
                        setTimeout(()=> {
                            this.hideModal('modal-single-add');
                        }, 1000)
                    }else {
                        toastr.warning(res.data.message)
                    }
                    this.handleButton('btn-single-add', 'stop');

                })
                .catch(e => {
                    console.log("Error: "+e)
                    toastr.error("Failed add item")
                    this.handleButton('btn-single-add', 'stop');

                })
            })

        },        

        handlerSaveArrangedLayout: function() {
            this.handleButton('btn-save-layout', 'load').then(() => {
                axios.post('/api/arranged_layout/post_layout', {
                    data: JSON.stringify(this.datatable.fields),
                    name: "LAYOUT_GADC"
                })
                .then(res => {
                    if(res.data.success) {
                        toastr.success(res.data.message, 'Success')
                        this.initArangedLayout().then(() => {
                            this.handlerArrangedStyle();
                        });
                        setTimeout(()=> {
                            this.hideModal('modal-layout');
                        }, 1000)
                    }else {
                        toastr.warning(res.data.message)
                    }
                    this.handleButton('btn-save-layout', 'stop');
                })
                .catch(e => {
                    console.log("Error: "+e)
                    toastr.error("Failed save layout change")
                    this.handleButton('btn-save-layout', 'stop');

                })
            })
        },

        initArangedLayout: function() {
            return new Promise((resolve) => {
                axios.post('/api/arranged_layout/get_user_layout', {
                    name: 'LAYOUT_GADC'
                })
                .then(res => {
                    if(res.data.length !== FieldMRMCentral.length) {
                        this.datatable.fields = FieldMRMCentral;
                    }else {
                        this.datatable.fields = res.data;
                    }
                    resolve();
                })
                .catch(e => {
                    console.log("Error: " +e);
                    resolve();
                })
            })
        },

        handleButton: function(id, status) {
            let element = document.getElementById(id);
            return new Promise((resolve, reject) => {
                if(status == "load") {
                    element.className += " is-loading";
                    element.disabled = true;

                    setTimeout(() => {
                       resolve(); 
                    }, 500);

                }else {
                    element.className = "button";
                    element.disabled = false;
                    resolve();
                }
            })
        },

        handlerArrangedStyle: function() {
            if(this.datatable.fields.length > 0) {
                let card_table = document.getElementsByClassName("list-group-item");
                card_table[0].style.cssText = `
                    border-top-left-radius: 4px !important; 
                    border-top-right-radius: 4px !important
                `;
                card_table[card_table.length-1].style.cssText = `
                    border-bottom-left-radius: 4px !important; 
                    border-bottom-right-radius: 4px !important`
                ;
            }
        },

        handlerResetLayout: function() {
            this.datatable.fields = FieldMRMCentral;
        },

        handlerExportData: function() {
            this.loading.isLoading = true;
            axios.get(`/api/production_control_hangar/gadc/export`)
            .then(res => {
                if(res.data.length < 1) {
                    toastr.warning("Data not available");
                    this.loading.isLoading = false;
                    return;
                }

                this.handlerExport(res.data, 'GADC Request Monitoring').then(() => {
                    this.loading.isLoading = false;
                });
            })
            .catch(e => {
                console.log("Error: " + e);
                this.loading.isLoading = false;
                toastr.error("Undefined error")
            })
        },

        handlerExport: function(data, name) {
            return new Promise((resolve, reject) => {
                let tmp = XLSX.utils.json_to_sheet(data)                 
                let wb = XLSX.utils.book_new();

                XLSX.utils.book_append_sheet(wb, tmp, name)
                XLSX.writeFile(wb, `gadc_request_monitoring.xlsx`)

                resolve();
            })
        },

        addTag: function (newTag) {
            this.options_ac.push({ac_reg: newTag});
        },

        selectionChanged(params) {
            this.datatable.selectedRows = [];
            for(let i = 0; i < params.selectedRows.length; i++) {
                this.datatable.selectedRows.push(params.selectedRows[i].ID);
            }
        },

        loadItems() {
            this.handleDatatableChange(this.datatable.serverParams).then(()=> {
                this.loading.isLoading = false;
            });
            
        },

        handlerDateColumns: function(e) {
            var el_3 = $('*[placeholder="Filter date of provision"]');
            if(el_3.length){el_3[0].type = 'date';}                     
        },

        handleDatatableChange: function(params) {
            this.loading.isLoading = true;

            return new Promise((resolve, reject) => {

                axios.post('/api/production_control_hangar/gadc/get_datatable', params)
                .then(res => {
                    this.datatable.rows = res.data
                    this.loading.isLoading = false;
                    resolve();
                })
                .catch(e => {
                    console.log("Error: "+e)
                    this.loading.isLoading = false;
                    resolve();
                })
            })
        },

        handlerDeleteItem: function(id) {
            swal({
                title: "Delete Item",
                text: "Are you sure that you want to delete this item?",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
            .then((value) => {
                if (value) {
                    this.loading.isLoading = true;
                    axios.get('/api/production_control_hangar/gadc/delete/' + id)
                    .then(res => {
                        if(res.data.success) {
                            toastr.success(res.data.message);
                            this.initData();
                        }else {
                            toastr.error(res.data.message);
                        }
                        this.loading.isLoading = false;

                    })
                    .catch(e => {
                        console.log("Error: " +e);
                        toastr.error("Undefined error");
                        this.loading.isLoading = false;
                    })
        
                } else {
                    toastr.info("Canceled");
                    return;
                }
            });
        },

        permissionHandler: function() {
            this.grant_access = false;     
            this.exp_access = false;
            this.gah_access = false;    

            if(this.$can('pc_hangar_central_flc')) {
                this.grant_access = true;
            }

            if(this.$can('pc_hangar_central_flc_exp')) {
                this.exp_access = true; 
            }

            if(this.$can('pc_hangar_central_flc_gah')) {
                this.gah_access = true; 
            }

        },
    }
}

</script>
