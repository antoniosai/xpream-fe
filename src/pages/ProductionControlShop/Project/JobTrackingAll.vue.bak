<style scoped>
::v-deep .d-none {
    display: none !important;
}
.taskreview:hover {
    color: blue;
}

.matcard {
    background-color: #9effa8;
    position: absolute;
}

.flip-list-move {
    transition: transform 0.5s;
}
.no-move {
    transition: transform 0s;
}
.ghost {
    opacity: 0.5;
    background: #c8ebfb;
}
.list-group {
    min-height: 20px;
}
.list-group-item {
    cursor: move;
}
.list-group-item i {
    cursor: pointer;
}

::v-deep .crowdone {
    background-color: #c4f8c4;
}

.list-group-item:last-child {
    margin-bottom: 0 !important;
    border-bottom-right-radius: 0px !important;
    border-bottom-left-radius: 0px !important;
}

.list-group-item:first-child {
    border-top-right-radius: 0px !important;
    border-top-left-radius: 0px !important;
}

/* ::v-deep .crowwtcon{ */
/*background-color: #EBF8C4;*/
/* } */

::v-deep .crowwteco {
    background-color: #afd9f1;
}

::v-deep .line-numbers {
    min-width: 40px !important;
    max-width: 40px !important;
    height: 50px;
}

::v-deep .vgt-checkbox-col {
    min-width: 30px !important;
    max-width: 30px !important;
    height: 50px;
}

::v-deep .cstatus {
    min-width: 200px !important;
    max-width: 200px !important;
}

::v-deep .cac_reg {
    min-width: 120px !important;
    max-width: 120px !important;
}

::v-deep .csysstat {
    min-width: 100px !important;
    max-width: 100px !important;
}

::v-deep .cmhrsconf {
    min-width: 50px !important;
    max-width: 50px !important;
}

::v-deep .cmatcons {
    min-width: 50px !important;
    max-width: 50px !important;
}

::v-deep .cmrmstat {
    min-width: 100px !important;
    max-width: 100px !important;
}

::v-deep .cseq {
    min-width: 80px !important;
    max-width: 80px !important;
}

::v-deep .caufnr {
    min-width: 85px !important;
    max-width: 85px !important;
}

::v-deep .cdesc {
    min-width: 400px !important;
    max-width: 400px !important;
    white-space: nowrap;
    overflow: auto;
}

::v-deep .cacc {
    min-width: 100px !important;
    max-width: 100px !important;
}

::v-deep .ctask {
    min-width: 90px !important;
    max-width: 90px !important;
}

::v-deep .cprior {
    min-width: 80px !important;
    max-width: 80px !important;
}

::v-deep .crii {
    min-width: 80px !important;
    max-width: 80px !important;
}

::v-deep .czone {
    min-width: 180px !important;
    max-width: 180px !important;
}

::v-deep .cphas {
    min-width: 180px !important;
    max-width: 180px !important;
}

::v-deep .cskill {
    min-width: 200px !important;
    max-width: 200px !important;
    white-space: nowrap;
    overflow: auto;
}

::v-deep .cpmhrs {
    min-width: 60px !important;
    max-width: 60px !important;
}

::v-deep .cactmhrs {
    min-width: 60px !important;
    max-width: 60px !important;
}

::v-deep .cday {
    min-width: 270px !important;
    max-width: 270px !important;
}

::v-deep input.vs__search {
    position: absolute !important;
    background-image: unset;
    background: transparent;
    top: 3px;
    width: 100%;
    border: none;
    height: auto;
}

::v-deep .v-select .vs__open-indicator {
    fill: #6b6b6b;
    cursor: pointer;
}

::v-deep .v-select .vs__actions .vs__clear {
    background-color: transparent !important;
    fill: #ff0e0e;
    padding: 0;
    background-color: transparent !important;
    height: 100%;
    position: absolute;
    right: 14px;
    width: 30px;
}

::v-deep .v-select .vs__dropdown-toggle {
    background: white !important;
}

::v-deep .v-select .vs__dropdown-toggle {
    height: auto !important;
    min-height: 30px !important;
}

::v-deep .ctrackstat {
    min-width: 200px !important;
    max-width: 200px !important;
}

::v-deep .ctrackstatshop {
    min-width: 200px !important;
    max-width: 200px !important;
}

::v-deep .cdatedone {
    min-width: 185px !important;
    max-width: 185px !important;
}

::v-deep .crevpos {
    min-width: 180px !important;
    max-width: 180px !important;
}

::v-deep .cdatedonep {
    min-width: 185px !important;
    max-width: 185px !important;
}

::v-deep .cdfpstat {
    min-width: 100px !important;
    max-width: 100px !important;
}

::v-deep .cdfpfinding {
    min-width: 180px !important;
    max-width: 180px !important;
    white-space: nowrap;
    overflow: auto;
}

::v-deep .crmk {
    min-width: 300px !important;
    max-width: 300px !important;
    white-space: nowrap;
    overflow: auto;
}

::v-deep .csrmk {
    min-width: 300px !important;
    max-width: 300px !important;
    white-space: nowrap;
    overflow: auto;
}

::v-deep .custref {
    min-width: 150px !important;
    max-width: 150px !important;
    white-space: nowrap;
    overflow: auto;
}

::v-deep .custrmk {
    min-width: 300px !important;
    max-width: 300px !important;
    white-space: nowrap;
    overflow: auto;
}

::v-deep .vgt-left-align {
    white-space: normal !important;
}

::v-deep .table.vgt-table {
    font-size: 9px !important;
    border-collapse: collapse !important;
    background-color: #fff !important;
    width: 100% !important;
    max-width: 100% !important;
    table-layout: auto !important;
    border: 1px solid #dcdfe6 !important;
}

::v-deep .vgt-table.bordered td,
.vgt-table.bordered th {
    border: 1px solid #dcdfe6 !important;
    height: 20px !important;
    font-size: 9pt !important;
}

::v-deep .vgt-wrap__footer {
    font-size: 9pt !important;
    /* color: #606266; */
    padding: 0.5em !important;
    height: 35px !important;
    border: 1px solid #dcdfe6 !important;
    background: #ffffff !important;
}

::v-deep .vgt-wrap__footer .footer__row-count__label {
    font-size: 9pt !important;
    color: #909399 !important;
}

::v-deep .vgt-wrap__footer .footer__navigation__page-btn.disabled,
.vgt-wrap__footer .footer__navigation__page-btn.disabled:hover {
    opacity: 0.5 !important;
    cursor: not-allowed !important;
    box-shadow: 0 0 black !important;
    font-size: 9pt !important;
}

::v-deep .vgt-wrap__footer .footer__navigation__info,
.vgt-wrap__footer .footer__navigation__page-info {
    display: inline-block !important;
    color: #909399 !important;
    margin: 0 16px !important;
    font-size: 9pt !important;
}

::v-deep .vgt-wrap__footer .footer__navigation__page-btn {
    text-decoration: none !important;
    color: #606266 !important;
    font-weight: 700 !important;
    white-space: nowrap !important;
    font-size: 9pt !important;
}

::v-deep .vgt-global-search__input .input__icon .magnifying-glass {
    margin-top: 8px !important;
    margin-left: 10px !important;
    display: block !important;
    width: 12px !important;
    height: 12px !important;
    border: 2px solid #d6dae2 !important;
    position: relative !important;
    border-radius: 50% !important;
}

::v-deep .vgt-input,
.vgt-select {
    font-size: 9pt !important;
}

::v-deep .footer__row-count__label {
    margin-top: -7px !important;
}

::v-deep .footer__navigation {
    margin-top: -2px !important;
}

::v-deep .vgt-wrap__footer .footer__row-count__select {
    margin-top: -5px !important;
    width: 50px !important;
    padding: 0px 15px 0px 5px;
    border: 0px !important;
    border-radius: 0px !important;
    color: #606266 !important;
    font-weight: 700 !important;
    font-size: 9pt !important;
    margin-left: 0px !important;
    height: 32px !important;
    line-height: 32px !important;
}

::v-deep .vgt-wrap__footer .footer__navigation__page-info__current-entry {
    width: 50px !important;
    text-align: center !important;
    display: inline-block !important;
    margin: 0 10px !important;
    font-weight: 700 !important;
    height: 25px !important;
}

::v-deep .vgt-global-search {
    background: #ffffff !important;
    border: 1px solid #dcdfe6 !important;
}

::v-deep .vgt-table thead th {
    background: #ffffff !important;
    width: null;
}

::v-deep .action > i {
    padding: 5px;
    background: #fff;
    border-radius: 5px;
    font-size: 18px;
    border: 1px solid #eaeaea;
    -webkit-box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.07);
    box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.07);
    cursor: pointer;
}

::v-deep .action > i.warning {
    color: #ffc107;
}

::v-deep .action > i.warning:hover {
    background-color: #ffc107;
    color: white;
}

::v-deep .action > i.success {
    color: #13ce66;
}

::v-deep .action > i.primary {
    color: #026396;
}

::v-deep .action > i.success:hover {
    background-color: #13ce66;
    color: white;
}

::v-deep .action > i.primary:hover {
    background-color: #026396;
    color: white;
}

::v-deep .flex-middle-default {
    text-align: center;
}

::v-deep .status-handler {
    color: white;
    font-size: 9pt;
    border-radius: 5px;
    padding: 4px !important;
}

::v-deep .status-handler.success {
    background-color: #13ce66;
}

::v-deep .skill-handler {
    color: white;
    font-size: 9pt;
    border-radius: 5px;
    padding: 4px !important;
    cursor: pointer;
    margin-right: 4px;
}

::v-deep .skill-handler:last-child {
    margin-right: 0px;
}

::v-deep .skill-handler.active {
    background-color: #dc3545;
}

::v-deep .skill-handler.nonactive {
    background-color: #aeb3b8;
}

::v-deep .status-handler.primary {
    background-color: #026396;
}

::v-deep .status-handler.danger {
    background-color: #dc3545;
}

::v-deep .status-handler.warning {
    background-color: #ffc107;
}

::v-deep .multiselect {
    /* width: 230px !important; */
    font-size: 0.9375em !important;
    height: 35px !important;
    min-height: unset !important;
}

::v-deep .multiselect__placeholder {
    font-size: 12px !important;
}

::v-deep .multiselect__input {
    font-size: 0.9375em !important;
    height: 35px !important;
}

::v-deep .multiselect__select {
    height: 35px !important;
    padding: 10px 8px !important;
}

::v-deep .multiselect__tags {
    font-size: 10px !important;
    min-height: 30px !important;
    padding: 5px 10px 0px 5px !important;
}

::v-deep .multiselect__placeholder {
    margin-bottom: unset !important;
}

::v-deep .tooltip-x {
    position: relative !important;
    display: inline-block !important;
}

::v-deep .tooltip-x .tooltiptext-x {
    visibility: hidden !important;
    width: 120px !important;
    background-color: black !important;
    color: #fff !important;
    text-align: center !important;
    border-radius: 6px !important;
    padding: 5px 0 !important;

    /* Position the tooltip */
    position: absolute !important;
    z-index: 1000 !important;
    bottom: 100% !important;
    left: 50% !important;
    margin-left: -60px !important;
    white-space: nowrap !important;
}

::v-deep .tooltip-x:hover .tooltiptext-x {
    visibility: visible !important;
}

::v-deep #selected-row-actions .v-select.vs--single.vs--searchable {
    min-width: 250px;
    display: inline-block;
    font-size: 10px;
}


::v-deep #selected-row-actions button {
    margin: 0 5px;
}

::v-deep .multiselect__placeholder {
    margin: 1px 0 5px 0 !important;
}

::v-deep .multiselect__placeholder {
    font-size: 12px;
}
</style>

<template>
    <div v-show="hasAccess">
        <div class="content-header"></div>
        <div class="content-body" style="padding-top:40px;">
            <ul class="tab-menu">
                <li
                    v-if="
                        $bulkCan(
                            'pc_shop_tracking_system_view_jobcard',
                            'pc_shop_tracking_system_edit_jobcard',
                            'pc_shop_tracking_system_edit',
                            'pc_shop_tracking_system_view'
                        )
                    "
                    class="tab-link active"
                    data-tab="jobcard"
                >
                    Jobcard
                </li>
                <li
                    v-if="
                        $bulkCan(
                            'pc_shop_tracking_system_view_mdr',
                            'pc_shop_tracking_system_edit_mdr',
                            'pc_shop_tracking_system_edit',
                            'pc_shop_tracking_system_view'
                        )
                    "
                    v-on:click="
                        $router.push({
                            name: 'pc_shop.tracking.all.mdr'
                        })
                    "
                    class="tab-link"
                    data-tab="mdr"
                >
                    MDR
                </li>
                <li v-if="
                    $bulkCan(
                        'pc_shop_tracking_system_view_mrm', 
                        'pc_shop_tracking_system_edit_mrm',
                        'pc_shop_tracking_system_edit',
                        'pc_shop_tracking_system_view'
                    )
                    " 
                    v-on:click="
                        $router.push({
                            name: 'pc_shop.tracking.all.mrm'
                        })
                    "
                    class="tab-link" data-tab="mrm">
                    MRM
                </li>
            </ul>
            <div
                class="card tab-content active"
                id="jobcard"
                style="border-radius: 0px 8px 8px 8px;"
            >
                <div class="card-header">
                    <div class="title-area">
                        <h3 class="title">Jobcard Tracking</h3>
                    </div>
                    <!-- Option Box sebelum dirubah -->
                    <div class="option-box d-none test">
                        <div v-if="dfp_access" class="option-item">
                            <button
                                :disabled="!dfp_access"
                                v-on:click="
                                    dfp_access ? handlerModaldfplink() : ''
                                "
                                :class="
                                    dfpfolder == '' || dfpfolder == null
                                        ? 'button is-default'
                                        : 'button is-success'
                                "
                            >
                                <i class="material-icons">
                                    insert_drive_file
                                </i>
                                Set DFP Folder
                            </button>
                        </div>
                        <div class="option-item">
                            <select
                                @change="filterscanneddfp()"
                                v-model="multiselectfilteroption"
                                style="width:100px;"
                            >
                                <option
                                    :disabled="!dfp_url.length > 0"
                                    style="white-space: nowrap"
                                    value=""
                                    >Filter DFP</option
                                >
                                <option
                                    :disabled="!dfp_url.length > 0"
                                    style="white-space: nowrap"
                                    value="scan"
                                    ><b>available scanned files</b></option
                                >
                                <option
                                    :disabled="!dfp_url.length > 0"
                                    style="white-space: nowrap"
                                    value="unscan"
                                    ><b>unavailable scanned files</b></option
                                >
                            </select>
                            <multiselect
                                :close-on-select="false"
                                v-model="datatable.serverParams.filter.order"
                                tag-placeholder="Add this as new tag"
                                placeholder="Multiple Select Order No"
                                :options="options_order"
                                :multiple="true"
                                :taggable="true"
                                label="AUFNR"
                                track-by="AUFNR"
                                @tag="addTag"
                                @open="initfilterOrder"
                                :limit="6"
                                style="min-width: 250px; max-width: 400px; padding-left: 5px; max-height:350px;"
                            >
                            </multiselect>
                            <button
                                class="button is-secondary is-default"
                                style="width:15px;font-size:11px;"
                                v-on:click="clearfilterorder()"
                            >
                                <i class="material-icons" style="margin:0px;"
                                    >close</i
                                ></button
                            >&nbsp;&nbsp;
                            <button v-on:click="loadItems()">
                                <i class="material-icons">filter_list</i>
                                Filter
                            </button>
                        </div>
                        <div class="option-item">
                            <h4>
                                {{ projectinfo }}&nbsp;&nbsp;&nbsp;<button
                                    class="button is-secondary is-success"
                                    style="padding:0px 15px;height:30px;"
                                >
                                    {{ acreginfo }}
                                </button>
                            </h4>
                        </div>
                    </div>

                    <!-- Option Box setelah dirubah -->
                    <div class="option-box">
                        <div class="option-item">
                            <multiselect
                                :close-on-select="false"
                                v-model="datatable.serverParams.filter.AC_REG"
                                tag-placeholder="Add this as new tag"
                                placeholder="Multiple Select AC Reg"
                                :options="acRegs"
                                :multiple="true"
                                :taggable="true"
                                label="ac_reg"
                                track-by="ac_reg"
                                style="min-width: 250px; max-width: 400px; padding-left: 5px; max-height:350px;"
                            >
                            </multiselect>
                            <button
                                class="button is-secondary is-default"
                                style="width:15px;font-size:11px;"
                                v-on:click="clearfilterAC_REG()"
                            >
                                <i class="material-icons" style="margin:0px;"
                                    >close</i
                                ></button
                            >&nbsp;&nbsp;
                            <button v-on:click="loadItems()">
                                <i class="material-icons">filter_list</i>
                                Filter
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-content">
                    <div
                        style="box-sizing: border-box; position: relative; min-height: 20px;"
                    >
                        <div>
                            <loading
                                style="margin-top: 50px;"
                                :active.sync="loading.isLoading"
                                :can-cancel="false"
                                :is-full-page="false"
                                :color="loading.color"
                                :loader="loading.loaderType"
                            >
                            </loading>
                            <template>
                                <div v-show="renderedFields">
                                    <vue-good-table
                                        max-height="90vh"
                                        :fixed-header="true"
                                        ref="table-job-tracking"
                                        :columns="datatable.fields"
                                        :rows="datatable.rows"
                                        :row-style-class="rowStyleClassFn"
                                        styleClass="vgt-table bordered"
                                        mode="remote"
                                        :search-options="{
                                            enabled: true,
                                            trigger: 'enter',
                                            skipDiacritics: true,
                                            placeholder:
                                                'Fill and enter to search'
                                        }"
                                        :sort-options="{
                                            enabled: true
                                        }"
                                        :select-options="{
                                            enabled: grant_access
                                                ? true
                                                : dfp_access,
                                            selectOnCheckboxOnly: true
                                        }"
                                        :line-numbers="true"
                                        @on-search="onColumnSearch"
                                        @on-page-change="onPageChange"
                                        @on-sort-change="onSortChange"
                                        @on-column-filter="onColumnFilter"
                                        @on-per-page-change="onPerPageChange"
                                        @on-selected-rows-change="
                                            selectionChanged
                                        "
                                        @on-select-all="selectAll"
                                        @on-row-click="toggleSelectRow"
                                        :totalRows="datatable.totalRows"
                                        :pagination-options="{
                                            enabled: true,
                                            mode: 'pages',
                                            perPage:
                                                datatable.serverParams.perPage,
                                            position: 'bottom',
                                            perPageDropdown:
                                                datatable.perPageDropDown,
                                            dropdownAllowAll: true,
                                            setCurrentPage:
                                                datatable.serverParams.page,
                                            nextLabel: 'Next',
                                            prevLabel: 'Prev',
                                            rowsPerPageLabel: 'Rows per page',
                                            ofLabel: 'of',
                                            pageLabel: 'page',
                                            allLabel: 'All'
                                        }"
                                    >
                                        <div slot="table-actions">
                                            <div
                                                class="toolbar toolbar-default"
                                            >
                                                <div
                                                    class="toolbar-item toolbar-dropdown"
                                                ></div>
                                                <div
                                                    class="toolbar-item d-none test"
                                                    style="margin-right: -8px;"
                                                >
                                                    <div
                                                        v-on:click="
                                                            handlerExportJob()
                                                        "
                                                        class="single-button synchronize display-flex align-items-center justify-center tooltip-x"
                                                        style="background:#ffc107; margin-right: -2px; margin-left: -3px; padding-top: 6px;"
                                                        tabindex="0"
                                                    >
                                                        <span
                                                            class="tooltiptext-x"
                                                            >Export Excel</span
                                                        >
                                                        <i
                                                            class="material-icons warning sync_order"
                                                            >file_download</i
                                                        >
                                                    </div>
                                                </div>
                                                <div
                                                    class="toolbar-item d-none test"
                                                    style="margin-right: -10px;"
                                                >
                                                    <button
                                                        :disabled="
                                                            !grant_access
                                                        "
                                                        v-on:click="
                                                            handlerModalSingleAdd()
                                                        "
                                                        class="button is-default"
                                                    >
                                                        <i
                                                            class="material-icons"
                                                        >
                                                            add_circle
                                                        </i>
                                                        Add
                                                    </button>
                                                </div>
                                                <div
                                                    class="toolbar-item d-none test"
                                                    style="margin-right: -10px;"
                                                >
                                                    <button
                                                        :disabled="
                                                            !grant_access
                                                        "
                                                        v-on:click="
                                                            grant_access
                                                                ? handlerModalImport()
                                                                : ''
                                                        "
                                                        class="button is-default"
                                                    >
                                                        <i
                                                            class="material-icons"
                                                        >
                                                            insert_drive_file
                                                        </i>
                                                        Update
                                                    </button>
                                                </div>
                                                <div
                                                    class="toolbar-item"
                                                    style="margin-right: -10px;"
                                                >
                                                    <button
                                                        :disabled="
                                                            datatable.rows < 1
                                                        "
                                                        id="btn-collapse-all"
                                                        v-on:click="
                                                            handlerToggleAll(
                                                                'material-list',
                                                                'btn-collapse-all',
                                                                'icon-collapse-all',
                                                                'btn-material-list'
                                                            )
                                                        "
                                                        class="button is-default"
                                                    >
                                                        <i
                                                            id="icon-collapse-all"
                                                            class="material-icons"
                                                            >visibility</i
                                                        >
                                                        Material
                                                    </button>
                                                </div>
                                                <div
                                                    class="toolbar-item"
                                                    style="margin-right: -10px;"
                                                >
                                                    <button
                                                        v-on:click="onRefresh"
                                                        class="button"
                                                    >
                                                        <i
                                                            class="material-icons"
                                                        >
                                                            sync
                                                        </i>
                                                        Refresh
                                                    </button>
                                                </div>
                                                <div
                                                    class="toolbar-item tooltip-x d-none test"
                                                    style="margin-right: -10px; display:none !important"
                                                >
                                                    <button
                                                        :disabled="
                                                            !checklastsync
                                                        "
                                                        v-on:click="
                                                            checklastsync
                                                                ? handlerSyncData()
                                                                : ''
                                                        "
                                                        class="button is-danger"
                                                    >
                                                        <i
                                                            class="material-icons"
                                                        >
                                                            sync
                                                        </i>
                                                        Sync
                                                    </button>
                                                    <span
                                                        class="tooltiptext-x"
                                                        style="width:200px !important;"
                                                    >
                                                        LAST SYNC<br />
                                                        SAP->CRM :<br />
                                                        {{ lastsynccrm }}<br />
                                                        CRM->XPREAM :<br />
                                                        {{ lastsyncjc }}
                                                    </span>
                                                </div>

                                                <div
                                                    class="toolbar-item"
                                                    style="margin-right: 10px;"
                                                >
                                                    <button
                                                        v-on:click="
                                                            handlerlayout()
                                                        "
                                                        class="button is-success"
                                                    >
                                                        <i
                                                            class="material-icons"
                                                        >
                                                            grid_on
                                                        </i>
                                                        Layout
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <template
                                            slot="table-row"
                                            slot-scope="props"
                                        >
                                            <span
                                                v-if="
                                                    props.column.field ==
                                                        'MRM_STATUS'
                                                "
                                            >
                                                <span
                                                    v-if="
                                                        props.formattedRow[
                                                            props.column.field
                                                        ] == 'COMPLETE'
                                                    "
                                                >
                                                    <button
                                                        :id="
                                                            'btn-material-list-' +
                                                                props.index
                                                        "
                                                        statetoggle="0"
                                                        class="button is-secondary is-success btn-material-list"
                                                        v-on:click="
                                                            handlerToggle(
                                                                'btn-material-list-' +
                                                                    props.index,
                                                                'icon-material-list-' +
                                                                    props.index,
                                                                'material-list-' +
                                                                    props.index
                                                            )
                                                        "
                                                        style="width: 100%; height: 20px; line-height: 20px;"
                                                    >
                                                        {{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}
                                                    </button>
                                                </span>
                                                <span
                                                    v-else-if="
                                                        props.formattedRow[
                                                            props.column.field
                                                        ] == 'INCOMPLETE'
                                                    "
                                                >
                                                    <button
                                                        :id="
                                                            'btn-material-list-' +
                                                                props.index
                                                        "
                                                        statetoggle="0"
                                                        class="button is-secondary is-danger btn-material-list"
                                                        v-on:click="
                                                            handlerToggle(
                                                                'btn-material-list-' +
                                                                    props.index,
                                                                'icon-material-list-' +
                                                                    props.index,
                                                                'material-list-' +
                                                                    props.index
                                                            )
                                                        "
                                                        style="width: 100%; height: 20px; line-height: 20px;"
                                                    >
                                                        {{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}
                                                    </button>
                                                </span>
                                                <div
                                                    v-show="
                                                        props.formattedRow[
                                                            'MATERIAL'
                                                        ].length > 0
                                                    "
                                                >
                                                    <div
                                                        :id="
                                                            'material-list-' +
                                                                props.index
                                                        "
                                                        class="material-list"
                                                        style="margin-top: 5px; display: none;"
                                                    >
                                                        <div
                                                            class="card matcard"
                                                        >
                                                            <ul>
                                                                <li
                                                                    v-for="(mat,
                                                                    index) in props
                                                                        .formattedRow[
                                                                        'MATERIAL'
                                                                    ]"
                                                                    :key="index"
                                                                >
                                                                    {{ mat }}
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'DESCRIPTION'
                                                "
                                            >
                                                <div
                                                    class="is-row"
                                                    style="margin-bottom: 0px;"
                                                >
                                                    <div class="is-col is-90">
                                                        {{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}
                                                    </div>
                                                    <div class="is-col is-10">
                                                        <i
                                                            v-on:click="
                                                                modaltaskreview(
                                                                    props
                                                                        .formattedRow[
                                                                        'AUFNR'
                                                                    ],
                                                                    props.index
                                                                )
                                                            "
                                                            class="material-icons taskreview"
                                                            style="font-size: 16pt;line-height: 0; padding-top:10px; cursor:pointer;"
                                                            >chat</i
                                                        >
                                                    </div>
                                                </div>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'SEQ_SWIFT'
                                                "
                                            >
                                                <input
                                                    v-if="isPKG"
                                                    :disabled="!grant_access"
                                                    :value="
                                                        props.formattedRow[
                                                            props.column.field
                                                        ]
                                                    "
                                                    :id="
                                                        'job-track-seq-swift-' +
                                                            props.index
                                                    "
                                                    v-on:change="
                                                        handlerUpdateData(
                                                            props.formattedRow[
                                                                'ID'
                                                            ],
                                                            'SEQ_SWIFT',
                                                            'job-track-seq-swift-' +
                                                                props.index
                                                        )
                                                    "
                                                />
                                                <div
                                                    v-else
                                                    class="flex-middle-default"
                                                >
                                                    {{
                                                        props.formattedRow[
                                                            props.column.field
                                                        ]
                                                    }}
                                                </div>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'DATE_DONE'
                                                "
                                            >
                                                <input
                                                    :disabled="!grant_access"
                                                    :value="
                                                        props.formattedRow[
                                                            props.column.field
                                                        ]
                                                    "
                                                    :id="
                                                        'job-track-date-done-' +
                                                            props.index
                                                    "
                                                    v-on:change="
                                                        handlerUpdateData(
                                                            props.formattedRow[
                                                                'ID'
                                                            ],
                                                            'DATE_DONE',
                                                            'job-track-date-done-' +
                                                                props.index
                                                        )
                                                    "
                                                    type="date"
                                                />
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'REMARK'
                                                "
                                            >
                                                <input
                                                    :disabled="!grant_access"
                                                    :value="
                                                        props.formattedRow[
                                                            props.column.field
                                                        ]
                                                    "
                                                    :id="
                                                        'job-track-remark-' +
                                                            props.index
                                                    "
                                                    v-on:change="
                                                        handlerUpdateData(
                                                            props.formattedRow[
                                                                'ID'
                                                            ],
                                                            'REMARK',
                                                            'job-track-remark-' +
                                                                props.index
                                                        )
                                                    "
                                                />
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'NEED_OPEN'
                                                "
                                            >
                                                <select
                                                    v-model="
                                                        datatable.rows[
                                                            props.index
                                                        ].NEED_OPEN
                                                    "
                                                    :disabled="!grant_access"
                                                    :id="
                                                        'job-track-need-open-' +
                                                            props.index
                                                    "
                                                    v-on:change="
                                                        handlerUpdateData(
                                                            props.formattedRow[
                                                                'ID'
                                                            ],
                                                            'NEED_OPEN',
                                                            'job-track-need-open-' +
                                                                props.index
                                                        )
                                                    "
                                                >
                                                    <option value=""
                                                        >Select Option</option
                                                    >
                                                    <option value="YES"
                                                        >YES</option
                                                    >
                                                    <option value="NO"
                                                        >NO</option
                                                    >
                                                </select>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'TRACK_STATUS'
                                                "
                                            >
                                                <select
                                                    v-model="
                                                        datatable.rows[
                                                            props.index
                                                        ].TRACK_STATUS_ID
                                                    "
                                                    :disabled="!grant_access"
                                                    :id="
                                                        'job-track-jobcard-track-' +
                                                            props.index
                                                    "
                                                    v-on:change="
                                                        handlerUpdateData(
                                                            props.formattedRow[
                                                                'ID'
                                                            ],
                                                            'TRACK_STATUS',
                                                            'job-track-jobcard-track-' +
                                                                props.index
                                                        )
                                                    "
                                                >
                                                    <option value=""
                                                        >Select Option</option
                                                    >
                                                    <option
                                                        v-for="track in tracks"
                                                        :key="track.ID"
                                                        :value="track.ID"
                                                        >{{
                                                            track.TRACK_NAME
                                                        }}</option
                                                    >
                                                </select>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field == 'DAY'
                                                "
                                            >
                                                <!-- <multiselect 
                                                    :close-on-select="false"
                                                    v-model="findingcateg" 
                                                    tag-placeholder="" 
                                                    placeholder="Type and enter" 
                                                    :options="options_finding" 
                                                    :multiple="true" 
                                                    :taggable="true"
                                                    @tag="addTagf"
                                                    style="width:100%;"
                                                >
                                                </multiselect> -->

                                                <v-select
                                                    label="label"
                                                    :options="
                                                        optionsDays.get(
                                                            `${
                                                                datatable.rows[
                                                                    props.index
                                                                ].ac_reg
                                                            }`
                                                        ).days
                                                    "
                                                    v-model="
                                                        datatable.rows[
                                                            props.index
                                                        ].DAY
                                                    "
                                                    @input="
                                                        onChangeDays(
                                                            datatable.rows[
                                                                props.index
                                                            ].DAY,
                                                            props.row,
                                                            props.index
                                                        )
                                                    "
                                                ></v-select>
                                                <!-- <input :disabled="!grant_access" :value="props.formattedRow[props.column.field]" :id="'job-track-day-' +props.index" v-on:change="handlerUpdateData(props.formattedRow['ID'], 'DAY', 'job-track-day-' +props.index)" type="text"> -->
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field == 'RII'
                                                "
                                            >
                                                <select
                                                    v-model="
                                                        datatable.rows[
                                                            props.index
                                                        ].RII
                                                    "
                                                    :disabled="!grant_access"
                                                    :id="
                                                        'job-track-rii-' +
                                                            props.index
                                                    "
                                                    v-on:change="
                                                        handlerUpdateData(
                                                            props.formattedRow[
                                                                'ID'
                                                            ],
                                                            'RII',
                                                            'job-track-rii-' +
                                                                props.index
                                                        )
                                                    "
                                                >
                                                    <option value=""
                                                        >Select Option</option
                                                    ><option value="YES"
                                                        >YES</option
                                                    >

                                                    <option value="NO"
                                                        >NO</option
                                                    >
                                                </select>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'PRIORITY_TASK'
                                                "
                                            >
                                                <select
                                                    v-model="
                                                        datatable.rows[
                                                            props.index
                                                        ].PRIORITY_TASK
                                                    "
                                                    :disabled="!grant_access"
                                                    :id="
                                                        'job-track-priority-task-' +
                                                            props.index
                                                    "
                                                    v-on:change="
                                                        handlerUpdateData(
                                                            props.formattedRow[
                                                                'ID'
                                                            ],
                                                            'PRIORITY_TASK',
                                                            'job-track-priority-task-' +
                                                                props.index
                                                        )
                                                    "
                                                >
                                                    <option value=""
                                                        >Select Option</option
                                                    >
                                                    <option value="YES"
                                                        >YES</option
                                                    >
                                                    <option value="NO"
                                                        >NO</option
                                                    >
                                                </select>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'REVIEW_POSITION'
                                                "
                                            >
                                                <select
                                                    v-model="
                                                        datatable.rows[
                                                            props.index
                                                        ].REVIEW_POSITION_ID
                                                    "
                                                    :disabled="!grant_access"
                                                    :id="
                                                        'job-track-review-position-' +
                                                            props.index
                                                    "
                                                    v-on:change="
                                                        handlerUpdateData(
                                                            props.formattedRow[
                                                                'ID'
                                                            ],
                                                            'REVIEW_POSITION',
                                                            'job-track-review-position-' +
                                                                props.index
                                                        )
                                                    "
                                                >
                                                    <option value=""
                                                        >Select Option</option
                                                    >
                                                    <option
                                                        :disabled="
                                                            position.is_show ==
                                                            2
                                                                ? true
                                                                : false
                                                        "
                                                        v-for="position in positions"
                                                        :key="position.ID"
                                                        :value="position.ID"
                                                        >{{
                                                            position.POSITION_NAME
                                                        }}</option
                                                    >
                                                </select>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'PHASE'
                                                "
                                            >
                                                <select
                                                    v-model="
                                                        datatable.rows[
                                                            props.index
                                                        ].PHASE
                                                    "
                                                    :disabled="!grant_access"
                                                    :id="
                                                        'job-track-phase-' +
                                                            props.index
                                                    "
                                                    v-on:change="
                                                        handlerUpdateData(
                                                            props.formattedRow[
                                                                'ID'
                                                            ],
                                                            'PHASE_NEW',
                                                            'job-track-phase-' +
                                                                props.index
                                                        )
                                                    "
                                                >
                                                    <option value=""
                                                        >Set Default</option
                                                    >
                                                    <option
                                                        v-for="phase in phases"
                                                        :key="phase.PHASE_CODE"
                                                        :datacode="
                                                            phase.PHASE_CODE
                                                        "
                                                        :value="
                                                            phase.PHASE_NAME
                                                        "
                                                        >{{
                                                            phase.PHASE_NAME
                                                        }}</option
                                                    >
                                                </select>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'ZONE_AREA'
                                                "
                                            >
                                                <select
                                                    v-model="
                                                        datatable.rows[
                                                            props.index
                                                        ].ZONE_AREA
                                                    "
                                                    :disabled="!grant_access"
                                                    :id="
                                                        'job-track-zone-area-' +
                                                            props.index
                                                    "
                                                    v-on:change="
                                                        handlerUpdateData(
                                                            props.formattedRow[
                                                                'ID'
                                                            ],
                                                            'ZONE_AREA_NEW',
                                                            'job-track-zone-area-' +
                                                                props.index
                                                        )
                                                    "
                                                >
                                                    <option value=""
                                                        >Set Default</option
                                                    >
                                                    <option
                                                        v-for="zonearea in zoneareas"
                                                        :key="
                                                            zonearea.AREA_CODE
                                                        "
                                                        :datacode="
                                                            zonearea.AREA_CODE
                                                        "
                                                        :value="
                                                            zonearea.AREA_NAME
                                                        "
                                                        >{{
                                                            zonearea.AREA_NAME
                                                        }}</option
                                                    >
                                                </select>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'SKILL'
                                                "
                                            >
                                                <div
                                                    style="margin-top: 6px; text-align: left;"
                                                >
                                                    <span
                                                        v-for="(elem,
                                                        index) in props
                                                            .formattedRow[
                                                            'SKILL'
                                                        ]"
                                                        :key="index"
                                                        v-on:click="
                                                            handlerUpdateData(
                                                                props
                                                                    .formattedRow[
                                                                    'ID'
                                                                ],
                                                                'SKILL_ACTIVE',
                                                                elem,
                                                                index + 1
                                                            )
                                                        "
                                                        :class="
                                                            elem ==
                                                            props.formattedRow[
                                                                'SKILL_ACTIVE'
                                                            ]
                                                                ? 'skill-handler active'
                                                                : 'skill-handler nonactive'
                                                        "
                                                        >{{ elem }}</span
                                                    >
                                                </div>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'STATUS'
                                                "
                                            >
                                                <div
                                                    style="margin-top: 6px; text-align: center; cursor: pointer;"
                                                    v-on:click="
                                                        handlerModalTimeline(
                                                            props.formattedRow[
                                                                'ID'
                                                            ]
                                                        )
                                                    "
                                                >
                                                    <span
                                                        class="status-handler success"
                                                        v-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'DONE'
                                                        "
                                                        >{{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}</span
                                                    >
                                                    <span
                                                        class="status-handler warning"
                                                        v-else-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'PROGRESS'
                                                        "
                                                        >{{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}</span
                                                    >
                                                    <span
                                                        class="status-handler primary"
                                                        v-else-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'OPEN'
                                                        "
                                                        >{{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}</span
                                                    >
                                                    <span
                                                        v-else-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === null ||
                                                                props
                                                                    .formattedRow[
                                                                    props.column
                                                                        .field
                                                                ] === ''
                                                        "
                                                        >{{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}</span
                                                    >
                                                    <span
                                                        class="status-handler danger"
                                                        v-else
                                                        >{{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}</span
                                                    >
                                                </div>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'SYSTEM_STATUS'
                                                "
                                            >
                                                <div
                                                    style="margin-top: 6px; text-align: center;"
                                                >
                                                    <span
                                                        class="status-handler success"
                                                        v-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'DONE'
                                                        "
                                                        >{{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}</span
                                                    >
                                                    <span
                                                        class="status-handler warning"
                                                        v-else-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'PROGRESS'
                                                        "
                                                        >{{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}</span
                                                    >
                                                    <span
                                                        class="status-handler primary"
                                                        v-else-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'OPEN'
                                                        "
                                                        >{{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}</span
                                                    >
                                                    <span
                                                        v-else-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === null ||
                                                                props
                                                                    .formattedRow[
                                                                    props.column
                                                                        .field
                                                                ] === ''
                                                        "
                                                        >{{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}</span
                                                    >
                                                    <span
                                                        class="status-handler danger"
                                                        v-else
                                                    >
                                                        {{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}</span
                                                    >
                                                </div>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'DFPSTATUS'
                                                "
                                            >
                                                <div
                                                    style="margin-top: 6px; text-align: center;"
                                                >
                                                    <span
                                                        class="status-handler danger"
                                                        v-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'FINDING'
                                                        "
                                                        >{{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}</span
                                                    >
                                                    <span v-else>{{
                                                        props.formattedRow[
                                                            props.column.field
                                                        ]
                                                    }}</span>
                                                </div>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'MHRSCONF'
                                                "
                                            >
                                                <div
                                                    style="margin-top: 6px; text-align: center;"
                                                >
                                                    <span
                                                        class="status-handler success"
                                                        v-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'y'
                                                        "
                                                        ><i
                                                            class="material-icons"
                                                            style="font-size: 8pt;line-height: 0;"
                                                            >done</i
                                                        ></span
                                                    >
                                                    <span
                                                        v-else-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'n' &&
                                                                props
                                                                    .formattedRow[
                                                                    'STATUS'
                                                                ] === 'DONE'
                                                        "
                                                        class="status-handler danger tooltip-x"
                                                    >
                                                        <span
                                                            class="tooltiptext-x"
                                                            style="width:200px !important;"
                                                        >
                                                            {{
                                                                props
                                                                    .formattedRow[
                                                                    "LONGSYSSTAT"
                                                                ]
                                                            }}
                                                        </span>
                                                        <i
                                                            class="material-icons"
                                                            style="font-size: 8pt;line-height: 0;"
                                                            >close</i
                                                        ></span
                                                    >
                                                    <span
                                                        v-else-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'n' &&
                                                                props
                                                                    .formattedRow[
                                                                    'STATUS'
                                                                ] != 'DONE'
                                                        "
                                                        class="status-handler default"
                                                        ><i
                                                            class="material-icons"
                                                            style="font-size: 8pt;line-height: 0;"
                                                            >close</i
                                                        ></span
                                                    >
                                                </div>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'MATCONS'
                                                "
                                            >
                                                <div
                                                    style="margin-top: 6px; text-align: center;"
                                                >
                                                    <span
                                                        class="status-handler success"
                                                        v-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'y'
                                                        "
                                                        ><i
                                                            class="material-icons"
                                                            style="font-size: 8pt;line-height: 0;"
                                                            >done</i
                                                        ></span
                                                    >
                                                    <span
                                                        v-else-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'n' &&
                                                                props
                                                                    .formattedRow[
                                                                    'STATUS'
                                                                ] === 'DONE'
                                                        "
                                                        class="status-handler danger"
                                                        ><i
                                                            class="material-icons"
                                                            style="font-size: 8pt;line-height: 0;"
                                                            >close</i
                                                        ></span
                                                    >
                                                    <span
                                                        v-else-if="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ] === 'n' &&
                                                                props
                                                                    .formattedRow[
                                                                    'STATUS'
                                                                ] != 'DONE'
                                                        "
                                                        class="status-handler default"
                                                        ><i
                                                            class="material-icons"
                                                            style="font-size: 8pt;line-height: 0;"
                                                            >close</i
                                                        ></span
                                                    >
                                                </div>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'CUST_RMK'
                                                "
                                            >
                                                <span
                                                    v-if="cust_access == true"
                                                >
                                                    <input
                                                        :disabled="!cust_access"
                                                        :value="
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        "
                                                        :id="
                                                            'job-track-custrmk-' +
                                                                props.index
                                                        "
                                                        v-on:change="
                                                            handlerUpdateCustomerNote(
                                                                props
                                                                    .formattedRow[
                                                                    'ID'
                                                                ],
                                                                'CUST_RMK',
                                                                'job-track-custrmk-' +
                                                                    props.index
                                                            )
                                                        "
                                                    />
                                                </span>
                                                <span v-else>
                                                    {{
                                                        props.formattedRow[
                                                            props.column.field
                                                        ]
                                                    }}
                                                </span>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'CUST_REF'
                                                "
                                            >
                                                <input
                                                    :disabled="
                                                        cust_access ||
                                                        grant_access
                                                            ? false
                                                            : true
                                                    "
                                                    :value="
                                                        props.formattedRow[
                                                            props.column.field
                                                        ]
                                                    "
                                                    :id="
                                                        'job-track-custnote-' +
                                                            props.index
                                                    "
                                                    v-on:change="
                                                        handlerUpdateCustomerNote(
                                                            props.formattedRow[
                                                                'ID'
                                                            ],
                                                            'CUST_REF',
                                                            'job-track-custnote-' +
                                                                props.index
                                                        )
                                                    "
                                                />
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'SHOP_REMARK'
                                                "
                                            >
                                                {{
                                                    props.formattedRow[
                                                        props.column.field
                                                    ]
                                                }}
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'AUFNR'
                                                "
                                            >
                                                <span>
                                                    <a
                                                        :id="
                                                            'dfp-link-button-' +
                                                                props.index
                                                        "
                                                        target="_blank"
                                                    >
                                                        {{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}
                                                    </a>
                                                </span>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'PMHRS'
                                                "
                                            >
                                                <span v-if="is_cust"> </span>
                                                <span v-else>
                                                    <div
                                                        class="flex-middle-default"
                                                    >
                                                        {{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}
                                                    </div>
                                                </span>
                                            </span>
                                            <span
                                                v-else-if="
                                                    props.column.field ==
                                                        'ACTMHRS'
                                                "
                                            >
                                                <span v-if="is_cust"> </span>
                                                <span v-else>
                                                    <div
                                                        class="flex-middle-default"
                                                    >
                                                        {{
                                                            props.formattedRow[
                                                                props.column
                                                                    .field
                                                            ]
                                                        }}
                                                    </div>
                                                </span>
                                            </span>
                                            <span v-else>
                                                <div
                                                    class="flex-middle-default"
                                                >
                                                    {{
                                                        props.formattedRow[
                                                            props.column.field
                                                        ]
                                                    }}
                                                </div>
                                            </span>
                                        </template>
                                        <div
                                            slot="selected-row-actions"
                                            id="selected-row-actions"
                                        >
                                        <div class="d-none test">
                                            <button
                                                v-on:click="
                                                    handlerModalPrintSlip($event)
                                                "
                                                class="button is-secondary is-success"
                                                style="line-height: 0px; padding-right:10px;"
                                            >
                                                <center>
                                                    <i class="material-icons"
                                                        >print</i
                                                    >
                                                    Material Slip
                                                </center>
                                            </button>
                                            <v-select
                                                label="label"
                                                :options="optionsDay"
                                                v-model="daysAll"
                                                @input="onChangeDaysAll"
                                                style=""
                                            ></v-select>
                                            <button
                                                class="button is-primary"
                                                type="button"
                                                :disabled="
                                                    daysAll ? false : true
                                                "
                                                @click="onSetDays"
                                            >
                                                Set Days
                                            </button>
                                        </div>

                                            <select
                                                v-model="track_status"
                                                :disabled="
                                                    !grant_access ||
                                                        datatable.selectedRows
                                                            .length < 1
                                                "
                                            >
                                                <option value=""
                                                    >Update Jobcard
                                                    Status</option
                                                >
                                                <option
                                                    v-for="track in tracks"
                                                    :key="track.ID"
                                                    :value="track.ID"
                                                    >{{
                                                        track.TRACK_NAME
                                                    }}</option
                                                >
                                            </select>
                                            <button
                                                v-on:click="
                                                    handleUpdateStatus()
                                                "
                                                class="button is-default"
                                                type="button"
                                                id="update-status"
                                                :disabled="
                                                    !grant_access ||
                                                        datatable.selectedRows
                                                            .length < 1
                                                "
                                            >
                                                Set Status
                                            </button>

                                            <select
                                                v-model="update_positions"
                                                :disabled="
                                                    !grant_access ||
                                                        datatable.selectedRows
                                                            .length < 1
                                                "
                                            >
                                                <option value=""
                                                    >Update Positions</option
                                                >
                                                <option
                                                    :disabled="
                                                        position.is_show == 2
                                                            ? true
                                                            : false
                                                    "
                                                    v-for="position in positions"
                                                    :key="position.ID"
                                                    :value="position.ID"
                                                    >{{
                                                        position.POSITION_NAME
                                                    }}</option
                                                >
                                            </select>
                                            <button
                                                v-on:click="
                                                    handleUpdatePosition()
                                                "
                                                class="button is-default"
                                                type="button"
                                                id="update-position"
                                                :disabled="
                                                    !grant_access ||
                                                        datatable.selectedRows
                                                            .length < 1
                                                "
                                            >
                                                Set Position
                                            </button>

                                            <select
                                                v-if="dfp_access"
                                                v-model="update_dfp"
                                                :disabled="
                                                    !dfp_access ||
                                                        datatable.selectedRows
                                                            .length < 1
                                                "
                                            >
                                                <option value=""
                                                    >Update DFP</option
                                                >
                                                <option
                                                    v-for="dfpstat in dfpstats"
                                                    :key="dfpstat"
                                                    :value="dfpstat"
                                                    >{{ dfpstat }}</option
                                                >
                                            </select>
                                            <input
                                                v-if="
                                                    update_dfp != '' &&
                                                        dfp_access
                                                "
                                                v-model="dfpremark"
                                                :disabled="
                                                    !dfp_access ||
                                                        datatable.selectedRows
                                                            .length < 1
                                                "
                                                placeholder="remarks"
                                            />
                                            <button
                                                v-if="dfp_access"
                                                v-on:click="handleUpdateDFP()"
                                                class="button is-default"
                                                type="button"
                                                id="update-dfp"
                                                :disabled="
                                                    !dfp_access ||
                                                        datatable.selectedRows
                                                            .length < 1
                                                "
                                            >
                                                Set DFP
                                            </button>

                                            <span
                                                v-if="
                                                    update_dfp == 'FINDING' &&
                                                        dfp_access
                                                "
                                                :disabled="
                                                    !dfp_access ||
                                                        datatable.selectedRows
                                                            .length < 1
                                                "
                                            >
                                                <!--input type="checkbox" id="jack" value="Jack" v-model="findingcateg">
                                                <label for="jack">Jack</label>
                                                <input type="checkbox" id="john" value="John" v-model="findingcateg">
                                                <label for="john">John</label>
                                                <input type="checkbox" id="mike" value="Mike" v-model="findingcateg">
                                                <label for="mike">Mike</label-->
                                                <multiselect
                                                    :close-on-select="false"
                                                    v-model="findingcateg"
                                                    tag-placeholder=""
                                                    placeholder="Type and enter"
                                                    :options="options_finding"
                                                    :multiple="true"
                                                    :taggable="true"
                                                    @tag="addTagf"
                                                    style="width:100%;"
                                                >
                                                </multiselect>
                                            </span>
                                        </div>
                                    </vue-good-table>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
            <!-- modal import -->
            <div
                class="modal-box"
                id="modal-import-reservation"
                data-keyboard="false"
                data-backdrop="static"
            >
                <div class="modal sm">
                    <span
                        class="close"
                        v-on:click="hideModal('modal-import-reservation')"
                    ></span>
                    <div class="modal-header">
                        <h2 class="title">Update Data</h2>
                    </div>
                    <div class="modal-body" style="position: relative">
                        <label>
                            Update data <span class="is-req">*</span>
                        </label>
                        <div class="is-row">
                            <div class="form-item is-col is-100">
                                <input
                                    ref="file"
                                    id="file"
                                    style="all: unset"
                                    type="file"
                                    v-on:change="onChangeFileUpload()"
                                />
                                <div class="is-desc">Required .xlsx file</div>
                            </div>
                            <div class="form-item is-col is-100">
                                <button
                                    class="button is-secondary is-success"
                                    v-on:click="handlerExportforupdate()"
                                >
                                    Download Template
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="">
                        <button
                            class="button is-primary is-default cancel"
                            v-on:click="hideModal('modal-import-reservation')"
                        >
                            Close
                        </button>
                        <button
                            v-on:click="handlerImport()"
                            class="button is-success"
                            type="submit"
                            id="btn-import-reservation"
                        >
                            Save
                        </button>
                    </div>
                    <!-- </form> -->
                </div>
            </div>

            <!--modal TRB-->
            <div
                class="modal-box"
                id="modal-task-review"
                data-keyboard="false"
                data-backdrop="static"
            >
                <div class="modal sm">
                    <span
                        class="close"
                        v-on:click="hideModal('modal-task-review')"
                    ></span>
                    <!-- <form @submit.prevent="addFeedback"> -->
                    <div class="modal-header">
                        <h2 class="title">Task Review</h2>
                    </div>
                    <div
                        class="modal-body"
                        style="position: relative; font-size:12px;"
                        v-if="trb.order_index !== null"
                    >
                        <div class="form-item">
                            <div class="is-row" style="margin-bottom: 5px;">
                                <div class="is-col is-10">
                                    <label>Order No</label>
                                </div>
                                <div
                                    class="is-col is-40"
                                    style="border-radius: 5px;border: 1px solid grey;padding:5px;"
                                >
                                    {{ trb.form.orderno }}
                                </div>
                                <div class="is-col is-10">
                                    <label>Order Type</label>
                                </div>
                                <div
                                    class="is-col is-40"
                                    style="border-radius: 5px;border: 1px solid grey;padding:5px;"
                                >
                                    GA01
                                </div>
                            </div>
                        </div>
                        <div class="form-item">
                            <div class="is-row" style="margin-bottom: 5px;">
                                <div class="is-col is-10">
                                    <label>PM/PS</label>
                                </div>
                                <div
                                    class="is-col is-90"
                                    style="border-radius: 5px;border: 1px solid grey;padding:5px;"
                                >
                                    {{ trb.form.task_ref.ADPSP }}
                                </div>
                            </div>
                        </div>
                        <div class="form-item">
                            <div class="is-row" style="margin-bottom: 5px;">
                                <div class="is-col is-10">
                                    <label>System Status</label>
                                </div>
                                <div
                                    class="is-col is-90"
                                    style="border-radius: 5px;border: 1px solid grey;padding:5px;"
                                >
                                    {{
                                        datatable.rows[trb.order_index]
                                            .LONGSYSSTAT
                                    }}
                                </div>
                            </div>
                        </div>
                        <div class="form-item">
                            <div class="is-row" style="margin-bottom: 5px;">
                                <div class="is-col is-10">
                                    <label>Desc</label>
                                </div>
                                <div
                                    class="is-col is-90"
                                    style="border-radius: 5px;border: 1px solid grey;padding:5px;"
                                >
                                    {{
                                        datatable.rows[trb.order_index]
                                            .DESCRIPTION
                                    }}
                                </div>
                            </div>
                        </div>
                        <div class="form-item" v-if="!is_cust">
                            <div class="is-row" style="margin-bottom: 5px;">
                                <div class="is-col is-10">
                                    <label>Actual Mhrs</label>
                                </div>
                                <div
                                    class="is-col is-40"
                                    style="border-radius: 5px;border: 1px solid grey;padding:5px;"
                                >
                                    {{
                                        datatable.rows[trb.order_index].ACTMHRS
                                    }}
                                </div>
                                <div class="is-col is-10">
                                    <label>Plan Mhrs</label>
                                </div>
                                <div
                                    class="is-col is-40"
                                    style="border-radius: 5px;border: 1px solid grey;padding:5px;"
                                >
                                    {{ datatable.rows[trb.order_index].PMHRS }}
                                </div>
                            </div>
                        </div>
                        <div class="form-item">
                            <div class="is-row" style="margin-bottom: 5px;">
                                <div class="is-col is-10">
                                    <label>Material</label>
                                </div>
                                <div
                                    v-show="
                                        datatable.rows[trb.order_index].MATERIAL
                                            .length > 0
                                    "
                                    class="is-col is-90"
                                    style="border-radius: 5px;border: 1px solid grey;padding:5px;"
                                >
                                    <table>
                                        <tr
                                            v-for="(mat, index) in datatable
                                                .rows[trb.order_index].MATERIAL"
                                            :key="index"
                                        >
                                            <td>
                                                {{ mat.split("] ")[0] + "]" }}
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <!--div class="is-col is-90" style="border-radius: 5px;border: 1px solid grey;padding:5px;"> 
                                            <table>
                                                <tr><td>AMM Ref :</td><td>{{trb.form.task_ref.MAN_REF}}</td><td>Int Ref :</td><td>{{trb.form.task_ref.INT_REF}}</td></tr>
                                                <tr><td>AD Ref :</td><td>{{trb.form.task_ref.AD_REF}}</td><td>Ref :</td><td>{{trb.form.task_ref.BAMC_REF}}</td></tr>
                                                <tr><td>SB Ref :</td><td>{{trb.form.task_ref.SB_REF}}</td><td>Ext Id :</td><td>{{trb.form.task_ref.TL_EXTID}}</td></tr>
                                            </table>
                                        </div-->
                            </div>
                        </div>
                        <div class="form-item" style="margin-bottom: 0px;">
                            <div class="is-row" style="margin-bottom: 5px;">
                                <div class="is-col is-10">
                                    <label>Category</label>
                                </div>
                                <div class="is-col is-30">
                                    <select v-model="trb.form.feedbacktype">
                                        <option
                                            v-for="(categ, index) in trb.master
                                                .categ"
                                            :key="index"
                                            :value="categ.ID"
                                            >{{ categ.NAME }}</option
                                        >
                                    </select>
                                </div>
                                <div class="is-col is-10">
                                    <label>Urgency</label>
                                </div>
                                <div class="is-40">
                                    <div class="is-row">
                                        <div class="is-col is-70">
                                            <input
                                                id="prior-feedback"
                                                v-on:change="changePriorCapt()"
                                                style="margin-top: -6px;"
                                                type="range"
                                                min="1"
                                                max="3"
                                                step="1"
                                                v-model="
                                                    trb.form.priority.value
                                                "
                                            />
                                        </div>
                                        <div class="is-col is-30">
                                            <span
                                                id="prior-caption"
                                                :style="
                                                    'color :' +
                                                        trb.form.priority.color
                                                "
                                                >{{
                                                    trb.form.priority.text
                                                }}</span
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--div class="form-item" style="margin-bottom: 0px;">
                                    <div class="is-row" style="margin-bottom: 5px;">
                                        <div class="is-col is-30"> 
                                            <label>Attachment <small style="color: red; font-size: 8pt;">*(Maximum upload file size: 2 MB)</small></label>
                                        </div>
                                        <div class="is-70"> 
                                            <input style="all: unset"  id="file" class="form-control" ref="file" type="file" v-on:change="onChangeFileUpload()">
                                        </div>
                                    </div>
                                </div-->
                        <div class="form-item">
                            <textarea
                                placeholder="Insert your comment or feedback here"
                                rows="5"
                                v-model="trb.form.comment"
                            ></textarea>
                        </div>
                    </div>
                    <div class="modal-footer" style="">
                        <button
                            class="button is-primary is-default cancel"
                            v-on:click="hideModal('modal-task-review')"
                        >
                            Cancel
                        </button>
                        <button
                            v-on:click="addFeedback()"
                            type="button"
                            class="button"
                            id="btn-save-feedback"
                        >
                            Submit
                        </button>
                    </div>
                    <!-- </form> -->
                </div>
            </div>
            <!-- / Feedback Modal -->
            <!--div class="modal-box" id="modal-task-review" data-keyboard="false" data-backdrop="static">
                    <div class="modal" style="width:60%;">
                        <span class="close" v-on:click="hideModal('modal-task-review')"></span>
                            <div class="modal-header">
                                <h2 class="title">Task Review</h2>
                            </div>
                            <div class="modal-body" style="position: relative">
                                <table v-if="trb.order_index !== null">
                                    <tr><td>Order No / Type</td><td>{{datatable.rows[trb.order_index].AUFNR}} / {{datatable.rows[trb.order_index].AUART}}</td></tr>
                                    <tr><td>Order Type</td><td>{{datatable.rows[trb.order_index].DESCRIPTION}}</td></tr>
                                    <tr><td>Description</td><td>{{datatable.rows[trb.order_index].DESCRIPTION}}</td></tr>
                                    <tr><td>System Status</td><td>{{datatable.rows[trb.order_index].DESCRIPTION}}</td></tr>
                                    <tr><td>Total Plan Manhours</td><td>{{datatable.rows[trb.order_index].DESCRIPTION}}</td></tr>
                                    <tr><td>Total Actual Manhours</td><td>{{datatable.rows[trb.order_index].DESCRIPTION}}</td></tr>
                                    <tr><td>Material</td><td>{{datatable.rows[trb.order_index].DESCRIPTION}}</td></tr>
                                    <tr><td>PM/PS</td><td>{{datatable.rows[trb.order_index].DESCRIPTION}}</td></tr>
                                    <tr><td>References</td><td>{{datatable.rows[trb.order_index].DESCRIPTION}}</td></tr>
                                </table>
                                {{trb.task_ref}}
                            </div>
                            <div class="modal-footer" style="">
                                <button class="button is-primary is-default cancel" v-on:click="hideModal('modal-task-review')">Close</button>
                                <button v-on:click="slip_printout" class="button is-success"> Submit </button>
                            </div>

                    </div>
                </div-->

            <!--modal print slip-->
            <div
                class="modal-box"
                id="modal-print-slip"
                data-keyboard="false"
                data-backdrop="static"
            >
                <div class="modal" style="width:90%;">
                    <span
                        class="close"
                        v-on:click="hideModal('modal-print-slip')"
                    ></span>
                    <div class="modal-header">
                        <h2 class="title">Goods Issue Slip</h2>
                    </div>
                    <div
                        v-for="(dataplansliporder,
                        index) in dataplanslip.material"
                        :key="index"
                        :id="'printthisslip' + index"
                        class="modal-body"
                        style="position: relative"
                    >
                        <table>
                            <tr>
                                <td width="15%">Revision</td>
                                <td width="25%">
                                    : {{ $route.params.pg_id }}
                                    <!--
                                    : {{ dataplanslip.printdate }} /
                                    {{ user.name }} -->
                                </td>
                                <td width="20%"></td>
                                <td width="15%">Work Order</td>
                                <td width="25%">
                                    : {{ dataplansliporder.AUFNR }}
                                </td>
                            </tr>
                            <tr>
                                <td width="15%">Project Desc</td>
                                <td width="25%">: {{ projectinfo }}</td>
                                <td width="20%"></td>
                                <td width="15%">Order Type</td>
                                <td width="25%">
                                    : {{ dataplanslip.ordertype }}
                                </td>
                            </tr>
                            <tr>
                                <td width="15%">A/C Reg</td>
                                <td width="25%">: {{ acreginfo }}</td>
                                <td width="20%"></td>
                                <td width="15%">Sequence</td>
                                <td width="25%">
                                    : {{ dataplanslip.selectedsequence[index] }}
                                </td>
                            </tr>
                            <tr>
                                <td width="15%">A/C Type</td>
                                <td width="25%">: {{ actypeinfo }}</td>
                                <td width="20%"></td>
                                <td width="15%">Plant</td>
                                <td width="25%">: {{ hangarinfo }}</td>
                            </tr>
                            <tr>
                                <td width="15%"></td>
                                <td width="25%"></td>
                                <td width="20%"></td>
                                <td width="15%">S/Loc</td>
                                <td width="25%">
                                    :
                                    {{ sloc }}
                                </td>
                            </tr>
                        </table>

                        <table>
                            <thead>
                                <th>Material</th>
                                <!--th>Alternate</th-->
                                <th>Description</th>
                                <th>Qty</th>
                                <th>UoM</th>
                                <th>Batch No</th>
                                <th>Batch Manufacture</th>
                                <th>Taken By</th>
                                <th>Date Taken</th>
                                <th>Action</th>
                                <!--th>Status</th>
                                <th>Remark</th-->
                            </thead>
                            <tbody>
                                <tr
                                    v-for="(slip,
                                    index2) in dataplansliporder.MRM"
                                    :key="index2"
                                >
                                    <td>{{ slip.MATNR }}</td>
                                    <!--td>{{ slip.ALTERNATEPN }}</td-->
                                    <td>{{ slip.MAKTX }}</td>
                                    <td v-if="slip.BDMNG === null"></td>
                                    <td v-else>
                                        {{ parseFloat(slip.BDMNG).toFixed(2) }}
                                    </td>
                                    <td>{{ slip.MEINS }}</td>
                                    <td>
                                        <input
                                            style="border: none;border-bottom: 2px solid grey;"
                                            placeholder=""
                                            v-model="
                                                dataplanslip.batch[slip.ID]
                                            "
                                        />
                                    </td>
                                    <td>
                                        <input
                                            style="border: none;border-bottom: 2px solid grey;"
                                            placeholder=""
                                            v-model="
                                                dataplanslip.remark[slip.ID]
                                            "
                                        />
                                    </td>
                                    <!--td
                                        v-if="
                                            slip.RECEIVED_BY == '' ||
                                                slip.RECEIVED_BY == null
                                        "
                                    -->
                                    <td>
                                        <input
                                            style="border: none; border-bottom: 2px solid grey;"
                                            v-model="dataplanslip.recby[index]"
                                        />
                                    </td>
                                    <!--td v-else>{{ slip.RECEIVED_BY }}</td-->
                                    <!--td
                                        v-if="
                                            slip.DATEREC == '' ||
                                                slip.DATEREC == null
                                        "
                                    -->
                                    <td>
                                        <input
                                            type="date"
                                            style="border: none; border-bottom: 2px solid grey;"
                                            v-model="
                                                dataplanslip.recdate[index]
                                            "
                                        />
                                    </td>
                                    <!--td v-else>{{ slip.DATEREC }}</td-->
                                    <td>
                                        <button
                                            @click="
                                                dataplansliporder.MRM.splice(
                                                    index2,
                                                    1
                                                )
                                            "
                                            class="button is-danger"
                                        >
                                            Delete
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <hr />
                        <div width="100%" style="text-align:right;">
                            <VueBarcode
                                :value="dataplansliporder.AUFNR"
                                height="50"
                                textPosition="top"
                                :text="'Work Order: ' + dataplansliporder.AUFNR"
                            >
                                Show this if the rendering fails.
                            </VueBarcode>
                        </div>
                    </div>
                    <div class="modal-footer" style="">
                        *the data that you change/update in the underlined field
                        input here will not be saved, this editable feature is
                        only for replace handwriting for printing purpose
                        <br /><br />
                        insert a page-break for each work order
                        <input type="checkbox" v-model="pagebreak" />
                        <button
                            v-on:click="slip_printout"
                            class="button is-success"
                        >
                            Print
                        </button>
                        <button
                            class="button is-primary is-default cancel"
                            v-on:click="hideModal('modal-print-slip')"
                        >
                            Close
                        </button>
                    </div>
                    <!-- </form> -->
                </div>
            </div>

            <div class="modal-box" data-keyboard="false" data-backdrop="static">
                <div
                    id="outputprintslip"
                    class="modal-body"
                    style="position: relative; font-size: 9px;"
                >
                    <div
                        v-for="(dataplansliporder,
                        index) in dataplanslip.material"
                        :key="index"
                        :id="'printthisslip' + index"
                        class="modal-body detectpagebreak"
                        style="position: relative"
                    >
                        <table width="100%">
                            <tr>
                                <td width="30%">
                                    <img src="/assets/img/logo-black.png" />
                                </td>
                                <td width="40%" style="text-align:center;">
                                    <h3>Goods Issue Slip</h3>
                                </td>
                                <td width="30%"></td>
                            </tr>
                        </table>

                        <table width="100%">
                            <tr>
                                <td width="10%">Revision</td>
                                <td width="55%">
                                    : {{ $route.params.pg_id }}
                                    <!--
                                    : {{ dataplanslip.printdate }} /
                                    {{ user.name }} -->
                                </td>
                                <td width="10%"></td>
                                <td width="10%">Work Order</td>
                                <td width="15%">
                                    : {{ dataplansliporder.AUFNR }}
                                </td>
                            </tr>
                            <tr>
                                <td width="10%">Project Desc</td>
                                <td width="55%">: {{ projectinfo }}</td>
                                <td width="10%"></td>
                                <td width="10%">Order Type</td>
                                <td width="15%">
                                    : {{ dataplanslip.ordertype }}
                                </td>
                            </tr>
                            <tr>
                                <td width="10%">A/C Reg</td>
                                <td width="55%">: {{ acreginfo }}</td>
                                <td width="10%"></td>
                                <td width="10%">Sequence</td>
                                <td width="15%">
                                    : {{ dataplanslip.selectedsequence[index] }}
                                </td>
                            </tr>
                            <tr>
                                <td width="10%">A/C Type</td>
                                <td width="55%">: {{ actypeinfo }}</td>
                                <td width="10%"></td>
                                <td width="10%">Plant</td>
                                <td width="15%">: {{ hangarinfo }}</td>
                            </tr>
                            <tr>
                                <td width="10%"></td>
                                <td width="55%"></td>
                                <td width="10%"></td>
                                <td width="10%">S/Loc</td>
                                <td width="15%">
                                    :
                                    {{ sloc }}
                                </td>
                            </tr>
                        </table>

                        <table
                            class="materialitem"
                            style="border-collapse: collapse;"
                            width="100%"
                        >
                            <thead>
                                <th>Material</th>
                                <!--th>Alternate</th-->
                                <th>Description</th>
                                <th>Qty</th>
                                <th>UoM</th>
                                <th>Batch No</th>
                                <th>Batch Manufacture</th>
                                <th>Taken By</th>
                                <th>Date Taken</th>
                                <!--th>Status</th>
                                <th>Remark</th-->
                            </thead>
                            <tbody>
                                <tr
                                    v-for="(slip,
                                    index2) in dataplansliporder.MRM"
                                    :key="index2"
                                >
                                    <td>{{ slip.MATNR }}</td>
                                    <!--td>{{ slip.ALTERNATEPN }}</td-->
                                    <td>{{ slip.MAKTX }}</td>
                                    <td v-if="slip.BDMNG === null"></td>
                                    <td v-else>
                                        {{ parseFloat(slip.BDMNG).toFixed(2) }}
                                    </td>
                                    <td>{{ slip.MEINS }}</td>
                                    <td>
                                        <span
                                            style="border: none; border-bottom: 2px solid grey;"
                                            >{{
                                                dataplanslip.batch[slip.ID]
                                            }}</span
                                        >
                                    </td>
                                    <td>
                                        <span
                                            style="border: none; border-bottom: 2px solid grey;"
                                            >{{
                                                dataplanslip.remark[slip.ID]
                                            }}</span
                                        >
                                    </td>
                                    <!--td
                                        v-if="
                                            slip.RECEIVED_BY == '' ||
                                                slip.RECEIVED_BY == null
                                        "
                                    -->
                                    <td>
                                        <span
                                            style="border: none; border-bottom: 2px solid grey;"
                                            >{{
                                                dataplanslip.recby[index]
                                            }}</span
                                        >
                                    </td>
                                    <!--td v-else>{{ slip.RECEIVED_BY }}</td-->
                                    <!--td
                                        v-if="
                                            slip.DATEREC == '' ||
                                                slip.DATEREC == null
                                        "
                                    -->
                                    <td>
                                        <span
                                            style="border: none; border-bottom: 2px solid grey;"
                                            >{{
                                                dataplanslip.recdate[index]
                                            }}</span
                                        >
                                    </td>
                                    <!--td v-else>{{ slip.DATEREC }}</td-->
                                    <!--td>{{ slip.MATFULSTAT }}</td>
                                    <td>
                                        <span
                                            style="border: none; border-bottom: 2px solid grey;"
                                            >{{
                                                dataplanslip.remark[slip.ID]
                                            }}</span
                                        >
                                    </td-->
                                </tr>
                            </tbody>
                        </table>
                        <br />
                        Form No : GMF/B-051
                        <hr />
                        <br />
                        <div width="100%" style="text-align:right;">
                            <VueBarcode
                                :value="dataplansliporder.AUFNR"
                                height="50"
                                textPosition="top"
                                :text="'Work Order: ' + dataplansliporder.AUFNR"
                            >
                                Show this if the rendering fails.
                            </VueBarcode>
                        </div>
                        <hr />
                    </div>
                </div>
            </div>

            <!-- modal timeline -->
            <div
                class="modal-box"
                id="modal-timeline"
                data-keyboard="false"
                data-backdrop="static"
            >
                <div class="modal sm">
                    <span
                        class="close"
                        v-on:click="hideModal('modal-timeline')"
                    ></span>
                    <div class="modal-header">
                        <h2 class="title">Log Timeline</h2>
                    </div>
                    <div class="modal-body">
                        <div
                            style="font-size: 12pt; font-weight: bold; margin-bottom: 25px; color: #f98930"
                        >
                            {{ timelines.length ? timelines[0].revnr : "" }}
                        </div>
                        <div
                            style="position: relative; height:450px; overflow-y:auto; margin-left: 10px; margin-right: 10px;"
                        >
                            <!-- <TimelineJCMDR
                            v-for="(timeline, index) in timelines" :key="index"
                            :data="timeline" :index="index" /> -->
                        </div>
                    </div>
                    <div class="modal-footer" style="">
                        <button
                            class="button is-primary is-default cancel"
                            v-on:click="hideModal('modal-timeline')"
                        >
                            Close
                        </button>
                    </div>
                </div>
            </div>
            <!-- /modal timeline -->

            <!-- modal dfplink -->
            <div
                class="modal-box"
                id="modal-dfplink"
                data-keyboard="false"
                data-backdrop="static"
            >
                <div class="modal lg">
                    <span
                        class="close"
                        v-on:click="hideModal('modal-dfplink')"
                    ></span>
                    <div class="modal-header">
                        <h2 class="title">
                            Set Sharepoint Maintenance Record Project Folder
                        </h2>
                    </div>
                    <div class="modal-body" style="position: relative">
                        <label>
                            <hr />
                            Example : <br /><br />
                            /sites/NarrowBodyBaseMaintenance/TJP/TJP-4/01.
                            Aircraft Maintenance Record/2020/(Narrow) B737
                            SERIES/A4O-BD/JOBCARD/
                            <br />
                            <hr />
                        </label>
                        <div class="is-row">
                            <div class="is-col is-80">
                                <input
                                    :value="dfpfolder"
                                    id="inputdfpfolder"
                                    v-on:keyup.enter="
                                        handlerUpdateDFPfolder('inputdfpfolder')
                                    "
                                />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="">
                        <button
                            class="button is-primary is-default cancel"
                            v-on:click="hideModal('modal-dfplink')"
                        >
                            Close
                        </button>
                    </div>
                    <!-- </form> -->
                </div>
            </div>
            <!-- modal layout -->
            <div
                class="modal-box"
                id="modal-layout"
                data-keyboard="false"
                data-backdrop="static"
            >
                <div class="modal sm">
                    <span
                        class="close"
                        v-on:click="hideModal('modal-layout')"
                    ></span>
                    <div class="modal-header">
                        <h2 class="title">Arrange Table Layout</h2>
                    </div>
                    <div
                        class="modal-body"
                        style="position: relative; height:500px; overflow-y:auto;"
                    >
                        <draggable
                            :list="datatable.fields"
                            class="list-group"
                            ghost-class="ghost"
                            v-bind="dragOptions"
                            @start="drag = true"
                            @end="drag = false"
                            @change="handlerDateDoneJC"
                        >
                            <transition-group
                                type="transition"
                                :name="!drag ? 'flip-list' : null"
                            >
                                <div
                                    v-for="(element, index) in datatable.fields"
                                    :key="index + 0"
                                >
                                    <div
                                        v-if="element.isShow"
                                        class="list-group-item"
                                    >
                                        <i
                                            :class="
                                                element.fixed
                                                    ? 'fa fa-anchor'
                                                    : 'glyphicon glyphicon-pushpin'
                                            "
                                            @click="
                                                element.fixed = !element.fixed
                                            "
                                            aria-hidden="true"
                                        ></i>
                                        <div
                                            class="is-row"
                                            v-if="!element.hidden"
                                            style="font-weight:bold;"
                                        >
                                            <div class="is-col is-70">
                                                {{ element.label }}
                                            </div>
                                            <div class="is-col is-10">
                                                <button
                                                    class="button is-100 is-secondary is-success"
                                                    style="padding:0px !important;"
                                                    v-on:click="
                                                        element.hidden = true
                                                    "
                                                >
                                                    HIDE
                                                </button>
                                            </div>
                                        </div>
                                        <div class="is-row" v-else>
                                            <div class="is-col is-70">
                                                {{ element.label }}
                                            </div>
                                            <div class="is-col is-10">
                                                <button
                                                    class="button is-100 is-default"
                                                    v-on:click="
                                                        element.hidden = false
                                                    "
                                                >
                                                    SHOW
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </transition-group>
                        </draggable>
                    </div>
                    <div class="modal-footer" style="">
                        <button
                            class="button is-primary is-default cancel"
                            v-on:click="hideModal('modal-layout')"
                        >
                            Close
                        </button>
                        <button
                            v-on:click="handlerResetLayout()"
                            class="button is-danger"
                            type="button"
                            id="btn-reset-layout"
                        >
                            Reset Layout
                        </button>
                        <button
                            v-on:click="handlerSaveArrangedLayout()"
                            class="button is-primary"
                            type="button"
                            id="btn-save-layout"
                        >
                            Save Aranged Layout
                        </button>
                    </div>
                    <!-- </form> -->
                </div>
            </div>

            <!-- modal list backup -->
            <div
                class="modal-box"
                id="modal-download-backup"
                data-keyboard="false"
                data-backdrop="static"
            >
                <div class="modal sm">
                    <span
                        class="close"
                        v-on:click="hideModal('modal-download-backup')"
                    ></span>
                    <div class="modal-header">
                        <h2 class="title">Download Data Jobcard</h2>
                    </div>
                    <div class="modal-body" style="position: relative">
                        <button class="button" v-on:click="getdataexport('')">
                            today
                        </button>
                        <hr />
                        <span
                            v-for="(listdownload, index) in listdatabackup"
                            :key="index"
                        >
                            <button
                                class="button is-success"
                                v-on:click="
                                    getdataexport(listdownload.time_stamp)
                                "
                            >
                                Backup {{ listdownload.time_stamp }} ({{
                                    listdownload.rows
                                }}
                                rows)
                            </button>
                            <hr />
                        </span>
                    </div>
                    <div class="modal-footer" style="">
                        <button
                            class="button is-primary is-default cancel"
                            v-on:click="hideModal('modal-download-backup')"
                        >
                            Close
                        </button>
                    </div>
                    <!-- </form> -->
                </div>
            </div>

            <!-- modal single add -->
            <div
                class="modal-box"
                id="modal-single-add"
                data-keyboard="false"
                data-backdrop="static"
            >
                <div class="modal lg">
                    <span
                        class="close"
                        v-on:click="hideModal('modal-single-add')"
                    ></span>
                    <div class="modal-header">
                        <h2 class="title">Add Single Jobcard</h2>
                    </div>
                    <div class="modal-body" style="position: relative">
                        <label>
                            Input data <span class="is-req">*</span>
                        </label>
                        <div class="is-row">
                            <div class="form-item is-col is-25">
                                <input
                                    v-model="form.order_number"
                                    value=""
                                    type="text"
                                />
                                <div class="is-desc">Order Number</div>
                            </div>
                            <div class="form-item is-col is-10">
                                <input
                                    v-model="form.seq"
                                    value=""
                                    type="text"
                                />
                                <div class="is-desc">Seq</div>
                            </div>
                            <div class="form-item is-col is-15">
                                <select v-model="form.system_status">
                                    <option value="">Option</option>
                                    <option value="OPEN">OPEN</option>
                                    <option value="PROGRESS">PROGRESS</option>
                                    <option value="DONE">DONE</option>
                                </select>
                                <div class="is-desc">System Status</div>
                            </div>
                            <div class="form-item is-col is-50">
                                <input
                                    v-model="form.description"
                                    value=""
                                    type="text"
                                />
                                <div class="is-desc">Description</div>
                            </div>
                        </div>
                        <div class="is-row" style="margin-top: -10px;">
                            <div class="form-item is-col is-10">
                                <select v-model="form.done_access">
                                    <option value="">Option</option>
                                    <option value="YES">YES</option>
                                    <option value="NO">NO</option>
                                </select>
                                <div class="is-desc">Done Access</div>
                            </div>
                            <div class="form-item is-col is-10">
                                <select v-model="form.priority_task">
                                    <option value="">Option</option>
                                    <option value="YES">YES</option>
                                    <option value="NO">NO</option>
                                </select>
                                <div class="is-desc">Priority Task</div>
                            </div>
                            <div class="form-item is-col is-10">
                                <select v-model="form.rii">
                                    <option value="">Option</option>
                                    <option value="YES">YES</option>
                                    <option value="NO">NO</option>
                                </select>
                                <div class="is-desc">RII</div>
                            </div>
                            <div class="form-item is-col is-10">
                                <input
                                    v-model="form.task_code"
                                    value=""
                                    type="text"
                                />
                                <div class="is-desc">Task Code</div>
                            </div>
                            <div class="form-item is-col is-25">
                                <input
                                    v-model="form.skill"
                                    value=""
                                    type="text"
                                />
                                <div class="is-desc">
                                    Skill (WCT separate by coma)
                                </div>
                            </div>
                        </div>
                        <div class="is-row" style="margin-top: -10px;">
                            <div class="form-item is-col is-10">
                                <input
                                    v-model="form.pmhrs"
                                    value=""
                                    type="number"
                                />
                                <div class="is-desc">Pmhrs</div>
                            </div>
                            <div class="form-item is-col is-10">
                                <input
                                    v-model="form.actmhrs"
                                    value=""
                                    type="number"
                                />
                                <div class="is-desc">Act Mhrs</div>
                            </div>
                            <div class="form-item is-col is-10">
                                <input
                                    v-model="form.day"
                                    value=""
                                    type="number"
                                />
                                <div class="is-desc">Day</div>
                            </div>
                            <div class="form-item is-col is-10">
                                <select v-model="form.jc_track">
                                    <option value="">Option</option>
                                    <option
                                        v-for="track in tracks"
                                        :key="track.ID"
                                        :value="track.ID"
                                        >{{ track.TRACK_NAME }}</option
                                    >
                                </select>
                                <div class="is-desc">JC Track</div>
                            </div>
                            <div class="form-item is-col is-20">
                                <input
                                    v-model="form.date_done"
                                    value=""
                                    type="date"
                                />
                                <div class="is-desc">Date Done</div>
                            </div>
                            <div class="form-item is-col is-25">
                                <select v-model="form.review_position">
                                    <option value="">Option</option>
                                    <option
                                        :disabled="
                                            position.is_show == 2 ? true : false
                                        "
                                        v-for="position in positions"
                                        :key="position.ID"
                                        :value="position.ID"
                                        >{{ position.POSITION_NAME }}</option
                                    >
                                </select>
                                <div class="is-desc">Review Position</div>
                            </div>
                        </div>
                        <div class="is-row" style="margin-top: -10px;">
                            <div class="form-item is-col is-90">
                                <textarea
                                    v-model="form.remarks"
                                    rows="6"
                                ></textarea>
                                <div class="is-desc">Remarks</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="">
                        <button
                            class="button is-primary is-default cancel"
                            v-on:click="hideModal('modal-single-add')"
                        >
                            Close
                        </button>
                        <button
                            v-on:click="handlerSaveSinglJc()"
                            class="button is-success"
                            type="submit"
                            id="btn-single-add"
                        >
                            Save
                        </button>
                    </div>
                    <!-- </form> -->
                </div>
            </div>
            <!-- /modal single add  -->
        </div>
    </div>
</template>

<script>
import "vue-select/dist/vue-select.css";
import "vue-good-table/dist/vue-good-table.css";
import { VueGoodTable } from "vue-good-table";
import Loading from "vue-loading-overlay";
import axios from "axios";
import "vue-loading-overlay/dist/vue-loading.css";
import draggable from "vuedraggable";
import FieldJobcard from "./datatable/FieldJobcard";
import Multiselect from "vue-multiselect";
import "vue-multiselect/dist/vue-multiselect.min.css";
import XLSX from "xlsx";
// // import TimelineJCMDR from "./components/TimelineJCMDR";
import VueBarcode from "vue-barcode";
import moment from "moment";
import vSelect from "vue-select";

export default {
    data: () => ({
        pagebreak: true,
        renderedFields: false,
        hasAccess: false,
        loading: {
            isLoading: false,
            fullPage: false,
            loaderType: "dots",
            color: "#0065ff"
        },
        multiselectfilteroption: "",
        datatable: {
            fields: FieldJobcard,
            rows: [],
            specificColumns: {
                REVNR: [],
                AC_REG: [],
                PG: []
            },
            totalRows: "",
            serverParams: {
                columnFilters: {},
                sort: {
                    type: "",
                    field: ""
                },
                page: 1,
                perPage: 10,
                searchTerm: "",
                filter: {
                    order: [],
                    AC_REG: []
                },
                revnr: "",
                // skills: JSON.parse(localStorage.getItem("user"))
                //     .role.permission.filter(a => a.category == "c_wkshp")
                //     .map(a => a.display_name),
                // rvwPosition: JSON.parse(localStorage.getItem("user"))
                //     .role.permission.filter(a => a.category == "c_rvw_position")
                //     .map(a => a.display_name)
            },
            perPageDropDown: [10, 50, 100],
            selectedRows: []
        },
        tracks: [],
        zoneareas: [],
        phases: [],
        positions: [],
        dfpstats: ["NEED REVIEW", "FINDING", "NEED SCAN", "SCANNED", "ORDNER"],
        findingcateg: [],

        form: {
            revnr: "",
            order_number: "",
            seq: "",
            system_status: "",
            description: "",
            done_access: "",
            priority_task: "",
            rii: "",
            task_code: "",
            zone: "",
            skill: "",
            pmhrs: "",
            actmhrs: "",
            day: "",
            jc_track: "",
            date_done: "",
            review_position: "",
            remarks: ""
        },
        grant_access: false,
        cust_access: false,
        dfp_access: false,
        acreginfo: "",
        projectinfo: "",
        actypeinfo: "",
        lineinfo: "",
        hangarinfo: "",
        sloc: "2100",
        drag: false,
        checklastsync: false,
        lastsynccrm: "",
        lastsyncjc: "",
        options_order: [],
        options_finding: [
            "STAMP",
            "SIGN",
            "BON TOOL",
            "DATE",
            "RE-SCAN",
            "ARC",
            "MEASUREMENT VALUE"
        ],
        track_status: "",
        isPKG: false,
        update_positions: "",
        update_dfp: "",
        dfpremark: "",
        dfpfolder: "",
        dfp_url: [],
        timelines: [],
        listdatabackup: [],
        dataplanslip: {
            selectedorder: [],
            selectedsequence: [],
            printdate: "",
            ordertype: "GA01",
            material: [],
            recdate: [],
            recby: [],
            remark: [],
            batch: []
        },
        trb: {
            order_index: null,
            master: {
                categ: []
            },
            form: {
                orderno: "",
                nopeg: "",
                name: "",
                task_ref: {
                    ADPSP: "",
                    AD_REF: "",
                    SB_REF: "",
                    BAMC_REF: "",
                    CUST_REF: "",
                    INT_REF: "",
                    MAN_REF: "",
                    TL_EXTID: ""
                },
                feedbacktype: "",
                priority: {
                    value: 1,
                    color: "green",
                    text: "LOW"
                },
                comment: "",
                attachment: ""
            }
        },
        is_cust: false,
        optionsDay: [],
        optionsDays: new Map(),
        daysAll: ""
    }),

    components: {
        Loading,
        draggable,
        VueGoodTable,
        VueBarcode,
        // TimelineJCMDR,
        multiselect: Multiselect,
        "v-select": vSelect
    },
    watch: {
        clonedItems: function(newVal, oldVal) {
            // console.log(newVal);
            // console.log("---------------old---------------");
            // console.log(oldVal);
        },
        daysAll: (af, bef) => {
            // console.log(af, bef);
        }
    },
    async mounted() {
        if (
            !this.$bulkCan(
                "pc_shop_tracking_system_view_jobcard",
                "pc_shop_tracking_system_edit_jobcard",
                "pc_shop_tracking_system_edit",
                "pc_shop_tracking_system_view"
            )
        ) {
            this.$router.push({ name: "access_denied" });
        } else {
            this.hasAccess = true;

            const data = await (
                await axios.post("/api/production_control_hangar/get_pgimperf")
            ).data;

            if (data) {
                this.datatable.specificColumns.REVNR = data.REVNR;
                this.datatable.specificColumns.PG = data.PG;
                this.permissionHandler();

                this.initArangedLayout().then(() => {
                    this.renderedFields = true;
                    this.handlerArrangedStyle();
                    this.initData();
                    this.initTrack();
                    this.handlerDateDoneJC();
                    this.initPosition();
                    this.initZoneArea();
                    this.initPhase();
                    this.inittrbcateg();
                    //this.initfilterOrder();
                });
            }
        }
    },

    computed: {
        dragOptions() {
            return {
                animation: 200,
                group: "description",
                disabled: false,
                ghostClass: "ghost"
            };
        },

        acRegs() {
            return this.datatable.specificColumns.AC_REG;
        },

        user: function() {
            return JSON.parse(localStorage.getItem("user"));
        },

        clonedItems: function() {
            if (this.datatable.rows.length) {
                return JSON.parse(JSON.stringify(this.datatable.rows));
            }
        }
    },

    methods: {
        onChangeDaysAll: async function(val) {
            try {
                if (val) {
                    let obj = val;

                    const { date_plan, type, shift } = obj.value;

                    const params = JSON.parse(
                        JSON.stringify({
                            days_label: obj.label,
                            days: `${date_plan}, ${type}, ${shift}`
                        })
                    );
                } else {
                    this.daysAll = "";

                    // for (const [i, v] of this.datatable.rows.entries()) {
                    //     if (v.vgtSelected) {
                    //         this.$set(
                    //             this.datatable.rows[i],
                    //             "vgtSelected",
                    //             false
                    //         )
                    //     }
                    // }
                }
            } catch (e) {
                console.error(e);
                toastr.error(e);
            }
        },

        onSetDays: async function(e) {
            try {
                this.loading.isLoading = true;

                let rows = [];
                let params = {};

                const { label, value } = this.daysAll;
                const { date_plan, type, shift } = value;

                for (const [i, v] of this.datatable.rows.entries()) {
                    if (v.vgtSelected) {
                        params = JSON.parse(
                            JSON.stringify({
                                days_label: label,
                                days: `${date_plan}, ${type}, ${shift}`
                            })
                        );
                        rows.push(this.datatable.rows[i]);
                    }
                }

                const data = await (
                    await axios.post(
                        "/api/booking_and_submission/add_daily_menu_by_multi_selection",
                        {
                            params: params,
                            rows: rows
                        }
                    )
                ).data;

                const { status, message } = data;

                if (message === "Cant create daily menu due to expired date") {
                    toastr.warning(message);
                    this.loading.isLoading = false;
                    return;
                } else {
                    if (!status) {
                        toastr.warning(message);
                        this.loading.isLoading = false;
                        return;
                    } else {
                        toastr.success(message);
                        this.datatable.serverParams.searchTerm = "";
                        this.datatable.serverParams.revnr = this.$route.params.pg_id;
                        axios
                            .post(
                                "/api/production_control_hangar/get_tjobcardall",
                                Object.assign(
                                    {},
                                    {
                                        ...this.datatable.serverParams,
                                        revnr: this.datatable.specificColumns
                                            .REVNR
                                    }
                                )
                            )
                            .then(res => {
                                this.datatable.rows = res.data.DB.data;
                                this.datatable.specificColumns = Object.assign(
                                    {},
                                    this.datatable.specificColumns,
                                    {
                                        REVNR: res.data.REVNR,
                                        AC_REG: res.data.AC_REG
                                    }
                                );
                                this.datatable.totalRows = res.data.DB.total;
                                // toastr.remove();
                                // toastr.success("data refreshed");
                                this.loading.isLoading = false;
                            })
                            .catch(e => {
                                console.log("Error: " + e);
                                // toastr.remove();
                                // toastr.error("Undefined error");
                            });
                    }
                }
            } catch (e) {
                console.error(e);
            }
        },

        selectAll: function(selectRows) {
            try {
                const { selected, selectedRows } = selectRows;

                if (selectedRows.length) {
                    for (const [i, v] of selectedRows.entries()) {
                        this.$set(
                            this.datatable.rows[i],
                            "vgtSelected",
                            selected
                        );
                        //console.log(i, v)
                    }
                } else {
                    for (const [i, v] of this.datatable.rows.entries()) {
                        this.$set(
                            this.datatable.rows[i],
                            "vgtSelected",
                            selected
                        );
                        //console.log(i, v)
                    }
                }
            } catch (e) {
                console.error(e);
            }
        },

        toggleSelectRow: function(params) {
            //console.log(params);
            const { pageIndex, selected } = params;
            this.$set(this.datatable.rows[pageIndex], "vgtSelected", selected);

            const isExistSelected = this.datatable.rows.filter(
                row => row.vgtSelected
            ).length;
            if (!isExistSelected) {
                this.daysAll = "";
            }
        },

        selectRow: () => {
            for (const [i, v] of this.datatable.rows.entries()) {
                if (v.vgtSelected) {
                    this.$set(this.datatable.rows[i], "DAY", this.daysAll);
                    //console.log(i, v, this.actionDays)
                } else {
                }
            }
        },

        onChangeDays: async function(val, row, i, rowFormatted = null) {
            try {
                if (val == null) {
                    // this.initData();
                    return;
                }

                const { date_plan, type, shift } = val.value;

                const params = {
                    row: row,
                    days_label: val.label,
                    days: `${date_plan}, ${type}, ${shift}`
                };

                const data = await (
                    await axios.post(
                        "/api/booking_and_submission/add_daily_menu_by_single_selection",
                        params
                    )
                ).data;

                const { status, message } = data;

                if (!status) {
                    return toastr.warning(message);
                }

                toastr.success(message);
                this.datatable.serverParams.searchTerm = "";
                this.datatable.serverParams.revnr = this.$route.params.pg_id;
                axios
                    .post(
                        "/api/production_control_hangar/get_tjobcardall",
                        Object.assign(
                            {},
                            {
                                ...this.datatable.serverParams,
                                revnr: this.datatable.specificColumns.REVNR
                            }
                        )
                    )
                    .then(res => {
                        this.datatable.rows = res.data.DB.data;
                        this.datatable.specificColumns = Object.assign(
                            {},
                            this.datatable.specificColumns,
                            { REVNR: res.data.REVNR, AC_REG: res.data.AC_REG }
                        );
                        this.datatable.totalRows = res.data.DB.total;
                        // toastr.remove();
                        toastr.success("data refreshed");
                    })
                    .catch(e => {
                        console.log("Error: " + e);
                        // toastr.remove();
                        toastr.error("Undefined error");
                    });
            } catch (e) {
                console.error(e);
                // toastr.error(e);
            }
        },

        changePriorCapt: function() {
            if (parseInt(this.trb.form.priority.value) === 1) {
                this.trb.form.priority.color = "green";
                this.trb.form.priority.text = "LOW";
            } else if (parseInt(this.trb.form.priority.value) === 2) {
                this.trb.form.priority.color = "orange";
                this.trb.form.priority.text = "MEDIUM";
            } else {
                this.trb.form.priority.color = "red";
                this.trb.form.priority.text = "HIGH";
            }
        },

        modaltaskreview: function(aufnr, index) {
            this.trb.order_index = null;
            this.trb.form = {
                orderno: "",
                nopeg: this.user.username,
                name: this.user.name,
                task_ref: {
                    ADPSP: "",
                    AD_REF: "",
                    SB_REF: "",
                    BAMC_REF: "",
                    CUST_REF: "",
                    INT_REF: "",
                    MAN_REF: "",
                    TL_EXTID: ""
                },
                feedbacktype: "",
                priority: {
                    value: 1,
                    color: "green",
                    text: "LOW"
                },
                comment: "",
                attachment: ""
            };
            this.getdatatrb(aufnr, index).then(() => {
                $("#modal-task-review").modal("show");
            });
        },

        getdatatrb: function(aufnr, index) {
            return new Promise((resolve, reject) => {
                this.loading.isLoading = true;
                axios
                    .get("/api/production_control_hangar/taskreview/" + aufnr)
                    .then(res => {
                        this.loading.isLoading = false;
                        this.trb.form.orderno = aufnr;
                        this.trb.form.task_ref = res.data.data[0];
                        this.trb.order_index = index;
                        //console.log(this.trb);
                        resolve();
                    })
                    .catch(e => {
                        toastr.error("Failed get data");
                        this.loading.isLoading = false;
                        reject();
                    });
            });
        },

        addFeedback: function() {
            if (!this.validationFeedback()) {
                return;
            }

            this.handleButton("btn-save-feedback", "load").then(() => {
                axios
                    .post("/api/feedback/add_feedback_new", this.trb.form)
                    .then(res => {
                        if (res.data.success) {
                            this.hideModal("modal-task-review");
                            swal({
                                title: "Success add Feedback",
                                text:
                                    "Are you want add more detail information / attachment to the feedback?",
                                icon: "success",
                                buttons: true,
                                dangerMode: true
                            }).then(value => {
                                if (value) {
                                    this.$router.push({
                                        name: "trb.task",
                                        params: { trb: res.data.ticket_no }
                                    });
                                } else {
                                    return;
                                }
                            });
                        } else {
                            toastr.warning(res.data.message);
                        }
                        //console.log(res);
                        this.handleButton("btn-save-feedback", "stop");
                    })
                    .catch(e => {
                        console.log("Error: " + e);
                        toastr.error("Undefined error");
                        this.handleButton("btn-save-feedback", "stop");
                    });
            });
        },

        validationFeedback: function() {
            if (this.trb.form.comment == "") {
                toastr.warning("Comment cant be empty");
                return false;
            }
            if (this.trb.form.feedbacktype == "") {
                toastr.warning("Category cant be empty");
                return false;
            }
            return true;
        },

        handlerModalPrintSlip: function(param) {
            const isExistSelected = this.datatable.rows.filter(
                row => row.vgtSelected
            ).length;

            this.getdataplanslip().then(() => {
                $("#modal-print-slip").modal("show");
            });
        },

        slip_printout: function() {
            var divToPrint = document.getElementById("outputprintslip");
            var newWin = window.open("", "Print-Window");
            newWin.document.open();
            if (this.pagebreak) {
                var style =
                    "<style>@media print{.detectpagebreak {page-break-after:always}";
                style +=
                    "tr {page-break-inside:avoid; page-break-after:auto} td { page-break-inside:avoid; page-break-after:auto } thead { display:table-header-group } tfoot { display:table-footer-group }}";
                style +=
                    "@page { size: auto;  margin-bottom: 5mm; } body{-moz-transform: scale(0.7, 0.7);zoom: 0.7;zoom: 70%;} .materialitem table, .materialitem td, .materialitem th{ border: 1px solid black;}</style>";
            } else {
                var style =
                    "<style>@media print{.detectpagebreak {page-break-after:auto;  page-break-inside:avoid;}";
                style +=
                    "tr {page-break-inside:avoid; page-break-after:auto} td { page-break-inside:avoid; page-break-after:auto } thead { display:table-header-group } tfoot { display:table-footer-group }}";
                style +=
                    "@page { size: auto;  margin-bottom: 5mm; } body{-moz-transform: scale(0.7, 0.7);zoom: 0.7;zoom: 70%;} .materialitem table, .materialitem td, .materialitem th{ border: 1px solid black;}</style>";
            }
            // oncontextmenu='return false' onload='window.print()'
            newWin.document.write(
                style +
                    "<html><body oncontextmenu='return false' onload='window.print()'>" +
                    divToPrint.innerHTML +
                    "</body></html>"
            );
            newWin.document.close();
            setTimeout(function() {
                newWin.close();
            }, 1000);
        },

        getdataplanslip: function() {
            return new Promise((resolve, reject) => {
                this.loading.isLoading = true;
                this.dataplanslip.printdate = "";
                this.dataplanslip.material = [];
                this.dataplanslip.recby = [];
                this.dataplanslip.recdate = [];
                this.dataplanslip.remark = [];
                this.dataplanslip.batch = [];

                axios
                    .post("/api/production_control_hangar/print_slip", {
                        aufnr: this.dataplanslip.selectedorder,
                        revnr: this.$route.params.pg_id
                    })
                    .then(res => {
                        this.dataplanslip.material = res.data.data;
                        this.dataplanslip.printdate = new Date(
                            new Date().setTime(
                                new Date().getTime() +
                                    /*GMT*/ 7 * 60 * 60 * 1000
                            )
                        )
                            .toISOString()
                            .replace(/T|Z/g, " ");
                        this.hangarinfo = res.data.hangar;
                        this.loading.isLoading = false;
                        resolve();
                    })
                    .catch(e => {
                        toastr.error("Failed get data");
                        this.loading.isLoading = false;
                        reject();
                    });
            });
        },

        initData: function() {
            $(".vgt-fixed-header, .vgt-responsive")
                .wrapAll("<div class='new' />")
                .css("width", "unset")
                .css("overflow-x", "unset");
            $(".vgt-fixed-header")
                .css("position", "sticky")
                .css("position", "-webkit-sticky")
                .css("top", "0");
            $(
                ".vgt-fixed-header table thead tr:nth-child(2) th:nth-child(1)"
            ).text(".");
            $(".vgt-responsive thead").attr("hidden", true);
            $("th").removeAttr("style");
            $(".new").css("overflow-x", "auto");
            this.datatable.serverParams.page = "";
            this.datatable.serverParams.perPage = "";
            this.datatable.serverParams.searchTerm = "";
            this.loading.isLoading = true;

            this.daysAll = "";
            axios
                .post(
                    "/api/production_control_hangar/get_tjobcardall",
                    Object.assign(
                        {},
                        {
                            ...this.datatable.serverParams,
                            revnr: this.datatable.specificColumns.REVNR
                        }
                    )
                )
                .then(res => {
                    if (res.data.DB.data.length < 1) {
                        toastr.warning(`Currently No Data Available!`);
                    }

                    this.datatable.rows = res.data.DB.data;
                    this.datatable.specificColumns = Object.assign(
                        {},
                        this.datatable.specificColumns,
                        { REVNR: res.data.REVNR, AC_REG: res.data.AC_REG }
                    );
                    this.datatable.totalRows = res.data.DB.total;

                    this.loading.isLoading = false;
                })
                .catch(e => {
                    console.log("Error: " + e);
                    toastr.error("Undefined error");
                    this.loading.isLoading = false;
                });
            this.checksync();
            this.datatable.rows.forEach(this.matchindexdfp);
        },

        initArangedLayout: function() {
            return new Promise(resolve => {
                axios
                    .post("/api/arranged_layout/get_user_layout", {
                        name: "LAYOUT_JOBCARD"
                    })
                    .then(res => {
                        if (res.data.length !== FieldJobcard.length) {
                            if (this.is_cust) {
                                this.datatable.fields = FieldJobcard.map(l =>
                                    Object.assign({}, l)
                                ).filter(
                                    d =>
                                        d.label !== "System Status" &&
                                        d.label !== "MH" &&
                                        d.label !== "MAT" &&
                                        d.label !== "Pmhrs" &&
                                        d.label !== "Act Mhrs" &&
                                        d.label !== "Day" &&
                                        d.label !== "Paper Work Need Review" &&
                                        d.label !== "Finding Paper Work" &&
                                        d.label !== "Paper Work Need Scan" &&
                                        d.label !== "Jobcard Track (Shop)" &&
                                        d.label !== "Shop Remark"
                                );
                                resolve();
                            } else {
                                this.datatable.fields = FieldJobcard.map(l =>
                                    Object.assign({}, l)
                                );
                                resolve();
                            }
                        } else {
                            if (this.is_cust) {
                                this.datatable.fields = res.data.filter(
                                    d =>
                                        d.label !== "System Status" &&
                                        d.label !== "MH" &&
                                        d.label !== "MAT" &&
                                        d.label !== "Pmhrs" &&
                                        d.label !== "Act Mhrs" &&
                                        d.label !== "Day" &&
                                        d.label !== "Paper Work Need Review" &&
                                        d.label !== "Finding Paper Work" &&
                                        d.label !== "Paper Work Need Scan" &&
                                        d.label !== "Jobcard Track (Shop)" &&
                                        d.label !== "Shop Remark"
                                );
                                resolve();
                            } else {
                                this.datatable.fields = res.data;
                                resolve();
                            }
                        }
                    })
                    .catch(e => {
                        console.log("Error: " + e);
                        resolve();
                    });
            });
        },

        handlerSaveArrangedLayout: function() {
            this.handleButton("btn-save-layout", "load").then(() => {
                axios
                    .post("/api/arranged_layout/post_layout", {
                        data: JSON.stringify(this.datatable.fields),
                        name: "LAYOUT_JOBCARD"
                    })
                    .then(res => {
                        if (res.data.success) {
                            toastr.success(res.data.message, "Success");
                            this.initArangedLayout().then(() => {
                                this.handlerArrangedStyle();
                            });
                            setTimeout(() => {
                                this.hideModal("modal-layout");
                            }, 1000);
                        } else {
                            toastr.warning(res.data.message);
                        }
                        this.handleButton("btn-save-layout", "stop");
                    })
                    .catch(e => {
                        console.log("Error: " + e);
                        toastr.error("Failed save layout change");
                        this.handleButton("btn-save-layout", "stop");
                    });
            });
        },

        handlerArrangedStyle: function() {
            if (this.datatable.fields.length > 0) {
                let card_table = document.getElementsByClassName(
                    "list-group-item"
                );
                card_table[0].style.cssText = `
                    border-top-left-radius: 4px !important; 
                    border-top-right-radius: 4px !important
                `;
                card_table[card_table.length - 1].style.cssText = `
                    border-bottom-left-radius: 4px !important; 
                    border-bottom-right-radius: 4px !important`;
            }
        },

        handlerResetLayout: function() {
            this.handelerReset().then(() => {
                this.handlerDateDoneJC();
            });
        },

        handelerReset: function() {
            return new Promise(resolve => {
                if (this.is_cust) {
                    this.datatable.fields = FieldJobcard.map(l =>
                        Object.assign({}, l)
                    ).filter(
                        d =>
                            d.label !== "System Status" &&
                            d.label !== "MH" &&
                            d.label !== "MAT" &&
                            d.label !== "Pmhrs" &&
                            d.label !== "Act Mhrs" &&
                            d.label !== "Day" &&
                            d.label !== "Paper Work Need Review" &&
                            d.label !== "Finding Paper Work" &&
                            d.label !== "Paper Work Need Scan" &&
                            d.label !== "Jobcard Track (Shop)" &&
                            d.label !== "Shop Remark"
                    );
                    resolve();
                } else {
                    this.datatable.fields = FieldJobcard.map(l =>
                        Object.assign({}, l)
                    );
                    resolve();
                }
            });
        },

        checksync: function() {
            axios
                .post("/api/production_control_hangar/get_lastsyncjc", {
                    revnr: this.$route.params.pg_id
                })
                .then(res => {
                    this.checklastsync = res.data.sync;
                    this.lastsynccrm = res.data.lastsynccrm;
                    this.lastsyncjc = res.data.lastsyncjc;
                })
                .catch(e => {
                    console.log("Error: " + e);
                });
        },

        inittrbcateg: function() {
            axios.get("/api/feedback/get_categ").then(res => {
                this.trb.master.categ = res.data;
                //console.log(this.trb.master.categ);
            });
        },

        initTrack: function() {
            axios.get("/api/management/job_mdr_track/get/hangar").then(res => {
                this.tracks = res.data.filter(
                    d =>
                        d.TRACK_NAME !== "NEED RO" &&
                        d.TRACK_NAME !== "WAITING ATTACHMENT" &&
                        d.TRACK_NAME !== "WAITING NEXT RO"
                );
            });
        },

        initZoneArea: function() {
            axios.get("/api/management/zonearea/get_all").then(res => {
                this.zoneareas = res.data;
            });
        },

        initPhase: function() {
            axios.get("/api/management/phase/get_all").then(res => {
                this.phases = res.data;
            });
        },

        initPosition: function() {
            axios
                .get("/api/management/review_position/get_all_position")
                .then(res => {
                    this.positions = res.data;
                });
        },

        handlerModalImport: function() {
            this.data_import = "";
            document.getElementById("file").value = "";

            $("#modal-import-reservation").modal("show");
        },

        handlerModaldfplink: function() {
            $("#modal-dfplink").modal("show");
        },

        handlerExportforupdate: function() {
            axios
                .get(
                    `/api/production_control_hangar/export_jcforupdate/${this.$route.params.pg_id}/hangar`
                )
                .then(res => {
                    if (res.data.length < 1) {
                        toastr.warning("Data not available");
                        return;
                    }

                    this.handlerExportupdate(
                        res.data,
                        this.tracks,
                        this.positions,
                        this.zoneareas,
                        this.phases,
                        "JC Bulk Update"
                    ).then(() => {});
                })
                .catch(e => {
                    console.log("Error: " + e);
                    this.loading.isLoading = false;
                    toastr.error("Undefined error");
                });
        },

        handlerExportupdate: function(data, tracks, pos, zn, phs, name) {
            return new Promise((resolve, reject) => {
                let note = [
                    { COLUMN: "ORDER", RULE: "*required" },
                    { COLUMN: "ACCESS", RULE: "YES or NO" },
                    { COLUMN: "PRIORITY", RULE: "YES or NO" },
                    {
                        COLUMN: "TRACK_ID",
                        RULE:
                            "Input ID Number of Tracking Status from LIST_STATUS Sheet"
                    },
                    { COLUMN: "DATE DONE", RULE: "yyyy-mm-dd" },
                    {
                        COLUMN: "REVIEW_POSITION_ID",
                        RULE:
                            "Input ID Number of Position from LIST_POSITION Sheet"
                    },
                    {
                        COLUMN: "PHASE_NEW",
                        RULE: "Input PHASE_CODE of Phase from LIST_PHASE Sheet"
                    },
                    {
                        COLUMN: "ZONE_AREA_NEW",
                        RULE:
                            "Input AREA_CODE of Zone/Area from LIST_ZONE_AREA Sheet"
                    }
                ];

                note = XLSX.utils.json_to_sheet(note);
                let tmp = XLSX.utils.json_to_sheet(data);
                let tmp2 = XLSX.utils.json_to_sheet(tracks);
                let tmp3 = XLSX.utils.json_to_sheet(pos);
                let tmp4 = XLSX.utils.json_to_sheet(zn);
                let tmp5 = XLSX.utils.json_to_sheet(phs);
                let wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, tmp, name);
                XLSX.utils.book_append_sheet(wb, note, "NOTE");
                XLSX.utils.book_append_sheet(wb, tmp2, "LIST_STATUS");
                XLSX.utils.book_append_sheet(wb, tmp3, "LIST_POSITION");
                XLSX.utils.book_append_sheet(wb, tmp4, "LIST_ZONE_AREA");
                XLSX.utils.book_append_sheet(wb, tmp5, "LIST_PHASE");
                XLSX.writeFile(
                    wb,
                    `jobcard_update_${this.$route.params.pg_id}.xlsx`
                );

                resolve();
            });
        },

        onChangeFileUpload: function() {
            if (document.getElementById("file").files.length != 0) {
                this.data_import = this.$refs.file.files[0];
            }
        },

        validate: function() {
            if (this.data_import == "") {
                toastr.warning("File import can't be empty");
                return false;
            }

            return true;
        },

        handlerImport: function() {
            if (!this.validate()) return;

            this.handleButton("btn-import-reservation", "load").then(() => {
                let formData = new FormData();
                formData.append("revnr", this.$route.params.pg_id);
                formData.append("file", this.data_import);

                axios
                    .post(
                        "/api/production_control_hangar/import_jc",
                        formData,
                        {
                            headers: {
                                "Content-Type": "multipart/form-data"
                            }
                        }
                    )
                    .then(res => {
                        if (res.data.success) {
                            toastr.success(res.data.message, "Success");
                            this.initData();
                            setTimeout(() => {
                                this.hideModal("modal-import-reservation");
                            }, 1000);
                        } else {
                            setTimeout(() => {
                                toastr.warning(res.data.message);
                            }, 100);
                            toastr.warning(res.data.data);
                        }
                        this.handleButton("btn-import-reservation", "stop");
                    })
                    .catch(e => {
                        console.log("Error: " + e);
                        toastr.error("Undefined error");
                        this.handleButton("btn-import-reservation", "stop");
                    });
            });
        },

        handlerUpdateDFPfolder: function(elem) {
            if (!this.dfp_access) return;
            let elm = "";
            elm = document.getElementById(elem).value;
            /*if(elm!==null && elm!== ""){
                elm = encodeURIComponent(elm);
            }*/

            axios
                .post("/api/production_control_hangar/update_dfpfolder", {
                    revnr: this.$route.params.pg_id,
                    data: elm,
                    col: "dfpfolder"
                })
                .then(res => {
                    if (res.data.success) {
                        toastr.success(res.data.message);
                        this.hideModal("modal-dfplink");
                        this.permissionHandler();
                        //this.onRefresh();
                    } else {
                        toastr.remove();
                        toastr.error(res.data.message);
                    }
                })
                .catch(e => {
                    console.log("Error: " + e);
                    toastr.error("Undefined error");
                    this.loading.isLoading = false;
                });
        },

        handlerUpdateData: function(id, column, elem, position = "") {
            if (!this.grant_access) return;
            let elm = "";

            if (column == "DAY") {
                let check = document.getElementById(elem).value;
                // if (check !== '1A')
            }

            if (column == "SKILL_ACTIVE") {
                elm = elem;
            } else if (column == "ZONE_AREA_NEW" || column == "PHASE_NEW") {
                elm = $("#" + elem)
                    .find("option:selected")
                    .attr("datacode");
            } else {
                elm = document.getElementById(elem).value;
            }
            /*if(column === "SEQ_SWIFT" && !this.handlerValidateSeqSwift(elm)) {
                toastr.error("Seq Swift must be float value");
                return;
            }*/

            axios
                .post("/api/production_control_hangar/update_tjobcard", {
                    revnr: this.$route.params.pg_id,
                    id: id,
                    column: column,
                    data: elm
                })
                .then(res => {
                    if (res.data.success) {
                        toastr.success(res.data.message);
                        toastr.info("refreshing data ...");
                        //this.datatable.serverParams.perPage = "";
                        this.datatable.serverParams.searchTerm = "";
                        axios
                            .post(
                                "/api/production_control_hangar/get_tjobcardall",
                                Object.assign(
                                    {},
                                    {
                                        ...this.datatable.serverParams,
                                        revnr: this.datatable.specificColumns
                                            .REVNR
                                    }
                                )
                            )
                            .then(res => {
                                this.datatable.rows = res.data.DB.data;
                                this.datatable.specificColumns = Object.assign(
                                    {},
                                    this.datatable.specificColumns,
                                    {
                                        REVNR: res.data.REVNR,
                                        AC_REG: res.data.AC_REG
                                    }
                                );
                                this.datatable.totalRows = res.data.DB.total;
                                toastr.remove();
                                toastr.success("data refreshed");
                            })
                            .catch(e => {
                                console.log("Error: " + e);
                                toastr.remove();
                                toastr.error("Undefined error");
                            });
                    } else {
                        toastr.remove();
                        toastr.error(res.data.message);
                    }
                })
                .catch(e => {
                    console.log("Error: " + e);
                    toastr.error("Undefined error");
                    this.loading.isLoading = false;
                });
        },

        handlerUpdateCustomerNote: function(id, column, elem) {
            if (
                !this.cust_access &&
                (!this.grant_access || column != "CUST_REF")
            )
                return;
            let elm = "";
            let route = "";
            elm = document.getElementById(elem).value;
            if (this.cust_access) {
                route = "/api/production_control_hangar/custupdate_tjobcard";
            } else if (this.grant_access) {
                route = "/api/production_control_hangar/update_tjobcard";
            }

            axios
                .post(route, {
                    revnr: this.$route.params.pg_id,
                    id: id,
                    column: column,
                    data: elm
                })
                .then(res => {
                    if (res.data.success) {
                        toastr.success(res.data.message);
                        toastr.info("refreshing data ...");
                        this.datatable.serverParams.perPage = "";
                        this.datatable.serverParams.searchTerm = "";
                        axios
                            .post(
                                "/api/production_control_hangar/get_tjobcardall",
                                Object.assign(
                                    {},
                                    {
                                        ...this.datatable.serverParams,
                                        revnr: this.datatable.specificColumns
                                            .REVNR
                                    }
                                )
                            )
                            .then(res => {
                                this.datatable.rows = res.data.DB.data;
                                this.datatable.specificColumns = Object.assign(
                                    {},
                                    this.datatable.specificColumns,
                                    {
                                        REVNR: res.data.REVNR,
                                        AC_REG: res.data.AC_REG
                                    }
                                );
                                this.datatable.totalRows = res.data.DB.total;
                                toastr.remove();
                                toastr.success("data refreshed");
                            })
                            .catch(e => {
                                console.log("Error: " + e);
                                toastr.remove();
                                toastr.error("Undefined error");
                            });
                    } else {
                        toastr.remove();
                        toastr.error(res.data.message);
                    }
                })
                .catch(e => {
                    console.log("Error: " + e);
                    toastr.error("Undefined error");
                    this.loading.isLoading = false;
                });
        },

        /**
         * Datatable - Server Side
         */
        onRefresh() {
            //this.datatable.serverParams.page
            this.permissionHandler();
            this.updateParams({ page: this.datatable.serverParams.page });
            this.checksync();
            this.loadItems();
        },

        updateParams(newProps) {
            ll(newProps);
            this.datatable.serverParams = Object.assign(
                {},
                this.datatable.serverParams,
                newProps
            );
        },

        onPageChange(params) {
            this.updateParams({ page: params.currentPage });
            this.loadItems();
        },

        onPerPageChange(params) {
            this.updateParams({ page: 1 });
            this.updateParams({ perPage: params.currentPerPage });
            this.loadItems();
        },

        onSortChange(params) {
            this.updateParams({
                sort: {
                    type: params[0].type,
                    field: params[0].field
                }
            });
            this.updateParams({ page: 1 });
            this.loadItems();
        },

        onColumnFilter(params) {
            this.updateParams(params);
            this.updateParams({ page: 1 });
            this.loadItems();
        },

        onColumnSearch(params) {
            this.updateParams(params);
            this.updateParams({ page: 1 });
            this.loadItems();
        },

        /**
         * load items is what brings back the rows from server
         */
        loadItems() {
            this.handleDatatableChange(
                Object.assign(
                    {},
                    {
                        ...this.datatable.serverParams,
                        revnr: this.datatable.specificColumns.REVNR
                    }
                )
            ).then(() => {
                this.loading.isLoading = false;
                this.resetToggle(
                    "material-list",
                    "btn-collapse-all",
                    "icon-collapse-all",
                    "btn-material-list"
                );
                this.datatable.rows.forEach(this.matchindexdfp);
            });
        },

        handleDatatableChange: function(params) {
            this.loading.isLoading = true;

            return new Promise((resolve, reject) => {
                axios
                    .post(
                        "/api/production_control_hangar/get_tjobcardall",
                        params
                    )
                    .then(res => {
                        this.datatable.rows = res.data.DB.data;
                        this.datatable.specificColumns = Object.assign(
                            {},
                            this.datatable.specificColumns,
                            { REVNR: res.data.REVNR, AC_REG: res.data.AC_REG }
                        );
                        this.datatable.totalRows = res.data.DB.total;
                        this.loading.isLoading = false;
                        resolve();
                    })
                    .catch(e => {
                        console.log("Error: " + e);
                        this.loading.isLoading = false;
                        resolve();
                    });
            });
        },

        handlerSyncData: function() {
            swal({
                title: "Synchronize the project may take a few minutes",
                text: "Are you sure that you want to sync?",
                icon: "warning",
                buttons: true,
                dangerMode: true
            }).then(value => {
                if (value) {
                    this.loading.isLoading = true;
                    axios
                        .post(
                            "/api/production_control_hangar/sync_jobcard_multirevnr/",
                            {
                                revnr: this.datatable.specificColumns.REVNR
                            }
                        )
                        .then(res => {
                            if (res.data.success) {
                                toastr.success(res.data.message);
                                this.initData();
                            } else {
                                toastr.error(res.data.message);
                            }
                            this.loading.isLoading = false;
                            this.resetToggle(
                                "material-list",
                                "btn-collapse-all",
                                "icon-collapse-all",
                                "btn-material-list"
                            );
                        })
                        .catch(e => {
                            console.log("Error: " + e);
                            toastr.error("Undefined error");
                            this.loading.isLoading = false;
                            this.resetToggle(
                                "material-list",
                                "btn-collapse-all",
                                "icon-collapse-all",
                                "btn-material-list"
                            );
                        });
                } else {
                    toastr.info("Canceled");
                    return;
                }
            });
            this.checksync();
        },

        handlerSyncDataTwo: function() {
            swal({
                title: "Synchronize the project may take a few minutes",
                text: "Are you sure that you want to sync this project?",
                icon: "warning",
                buttons: true,
                dangerMode: true
            }).then(value => {
                if (value) {
                    this.loading.isLoading = true;
                    axios
                        .get(
                            `/api/production_control_hangar/sync_jobcard_new/${this.$route.params.pg_id}/false`
                        )
                        .then(res => {
                            if (res.data.success) {
                                toastr.success(res.data.message);
                                this.initData();
                            } else {
                                toastr.error(res.data.message);
                            }
                            this.loading.isLoading = false;
                            this.resetToggle(
                                "material-list",
                                "btn-collapse-all",
                                "icon-collapse-all",
                                "btn-material-list"
                            );
                        })
                        .catch(e => {
                            console.log("Error: " + e);
                            toastr.error("Undefined error");
                            this.loading.isLoading = false;
                            this.resetToggle(
                                "material-list",
                                "btn-collapse-all",
                                "icon-collapse-all",
                                "btn-material-list"
                            );
                        });
                } else {
                    toastr.info("Canceled");
                    return;
                }
            });
        },

        handlerDateDoneJC: function(e) {
            $(".vgt-fixed-header th input").attr("type", "text");
            var el = $('*[placeholder="Date done jc"]');

            if (el.length > 0) {
                el[0].type = "date";
            }
            $(".vgt-checkbox-col input").attr("type", "checkbox");
        },

        handlerToggle: function(btn_id, icon_id, elem_id) {
            //let elm_state = $(".button is-secondary is-success btn-material-list hidedetail")
            let elm_btn = document.getElementById(btn_id);

            if (elm_btn.getAttribute("statetoggle") == "0") {
                $("#" + btn_id).attr("statetoggle", "1");
                $("#" + elem_id).slideDown(150);
            } else {
                $("#" + btn_id).attr("statetoggle", "0");
                $("#" + elem_id).slideUp(150);
            }
        },

        handlerToggleAll: function(
            class_elem,
            btn_id,
            icon_id,
            btn_list_class
        ) {
            let elm_icon = document.getElementById(icon_id);
            let elm_btn = document.getElementById(btn_id);
            let elem_list_btn = document.getElementsByClassName(btn_list_class);

            if (elm_icon.innerHTML == "visibility") {
                elm_btn.innerHTML = `<i id="${icon_id}" class='material-icons'>visibility_off</i>Material`;

                $("." + class_elem).slideDown(150);
            } else {
                elm_btn.innerHTML = `<i id="${icon_id}" class='material-icons'>visibility</i>Material`;
                $("." + class_elem).slideUp(150);
            }
        },

        resetToggle: function(class_elem, btn_id, icon_id, btn_list_class) {
            let elm_icon = document.getElementById(icon_id);
            let elm_btn = document.getElementById(btn_id);
            let elem_list_btn = document.getElementsByClassName(btn_list_class);

            elm_btn.innerHTML = `<i id="${icon_id}" class='material-icons'>visibility</i>Material`;
            $("." + class_elem).hide();
        },

        custLabel({ label, status }) {
            return `[${status}] ${label}`;
        },

        handlerHideColumn(value) {
            if (value.label == "All Columns") {
                if (value.hidden) {
                    for (let i = 0; i < this.columns.length; i++) {
                        if (this.columns[i].label != "All Columns") {
                            this.datatable.fields[
                                this.columns[i].id
                            ].hidden = false;
                        }
                        this.columns[i].status = "HIDE";
                        this.columns[i].hidden = false;
                    }
                } else {
                    for (let i = 0; i < this.columns.length; i++) {
                        if (this.columns[i].label != "All Columns") {
                            this.datatable.fields[
                                this.columns[i].id
                            ].hidden = true;
                        }
                        this.columns[i].status = "SHOW";
                        this.columns[i].hidden = true;
                    }
                }
            } else {
                if (value.hidden) {
                    this.datatable.fields[value.id].hidden = false;
                    value.status = "HIDE";
                    value.hidden = false;
                } else {
                    this.datatable.fields[value.id].hidden = true;
                    value.status = "SHOW";
                    value.hidden = true;
                }
            }
        },

        getdatabackuplist: function() {
            return new Promise((resolve, reject) => {
                axios
                    .get(
                        `/api/production_control_hangar/getbackuplist_jobcard/${this.$route.params.pg_id}`
                    )
                    .then(res => {
                        if (res.data.length < 1) {
                            toastr.warning("Data not available");
                            resolve();
                        } else {
                            this.listdatabackup = res.data.data;
                            resolve();
                        }
                    })
                    .catch(e => {
                        console.log("Error: " + e);
                        toastr.error("Undefined error");
                        reject();
                    });
            });
        },

        handlerExportJob: function() {
            if (this.grant_access) {
                this.getdatabackuplist().then(() => {
                    $("#modal-download-backup").modal("show");
                });
            } else {
                this.getdataexport("");
            }
        },

        getdataexport: function(param) {
            let url = "";
            if (param == "") {
                url = `/api/production_control_hangar/export_jobcard/${this.$route.params.pg_id}/hangar`;
            } else {
                url =
                    `/api/production_control_hangar/export_jcbackup/${this.$route.params.pg_id}/hangar/` +
                    param;
            }
            this.loading.isLoading = true;
            axios
                .get(url)
                .then(res => {
                    if (res.data.length < 1) {
                        toastr.warning("Data not available");
                        this.loading.isLoading = false;
                        return;
                    }

                    this.handlerExport(
                        res.data,
                        "Jobcard Tracking " + param
                    ).then(() => {
                        this.loading.isLoading = false;
                    });
                })
                .catch(e => {
                    console.log("Error: " + e);
                    this.loading.isLoading = false;
                    toastr.error("Undefined error");
                });
        },

        handlerExport: function(data, name) {
            return new Promise((resolve, reject) => {
                if (name == "Jobcard Tracking ") {
                    data.forEach(this.matchindexdfp_forexport);
                    //console.log(data);
                }
                //console.log(data);
                let tmp = XLSX.utils.json_to_sheet(data);
                let wb = XLSX.utils.book_new();

                //add sharepoint dfp link

                XLSX.utils.book_append_sheet(wb, tmp, name);
                XLSX.writeFile(
                    wb,
                    `${this.acreginfo}_JC_TRACKING_${this.$route.params.pg_id}.xlsx`
                );

                resolve();
            });
        },

        handlerModalSingleAdd: function() {
            this.form.order_number = "";
            this.form.seq = "";
            this.form.system_status = "";
            this.form.description = "";
            this.form.done_access = "";
            this.form.priority_task = "";
            this.form.rii = "";
            this.form.task_code = "";
            this.form.zone = "";
            this.form.skill = "";
            this.form.pmhrs = "";
            this.form.actmhrs = "";
            this.form.day = "";
            this.form.jc_track = "";
            this.form.date_done = "";
            this.form.review_position = "";
            this.form.remarks = "";

            $("#modal-single-add").modal("show");
        },

        hideModal: function(modal_name) {
            $("#" + modal_name).modal("hide");
        },

        handlerSaveSinglJc: function() {
            if (!this.handlerValidation()) return;
            this.form.revnr = this.$route.params.pg_id;

            this.handleButton("btn-single-add", "load").then(() => {
                axios
                    .post("/api/production_control_hangar/add_tjc", this.form)
                    .then(res => {
                        if (res.data.success) {
                            toastr.success(res.data.message, "Success");
                            this.initData();
                            setTimeout(() => {
                                this.hideModal("modal-single-add");
                            }, 1000);
                        } else {
                            toastr.warning(res.data.message);
                        }
                        this.handleButton("btn-single-add", "stop");
                    })
                    .catch(e => {
                        console.log("Error: " + e);
                        toastr.error("Failed add item");
                        this.handleButton("btn-single-add", "stop");
                    });
            });
        },

        handlerValidation: function() {
            if (this.form.order_number == "") {
                toastr.warning("Order number field is required");
                return false;
            }
            return true;
        },

        handleButton: function(id, status) {
            let element = document.getElementById(id);
            return new Promise((resolve, reject) => {
                if (status == "load") {
                    element.className += " is-loading";
                    element.disabled = true;

                    setTimeout(() => {
                        resolve();
                    }, 500);
                } else {
                    element.className = "button";
                    element.disabled = false;
                    resolve();
                }
            });
        },

        handlerlayout: function() {
            $("#modal-layout").modal("show");
        },

        rowStyleClassFn(row) {
            if (row.SYSTEM_STATUS == "DONE") {
                return "crowdone";
            } else if (
                row.STATUS == "DONE" &&
                (row.MHRSCONF == "n" || row.MATCONS == "n")
            ) {
                return "crowwtcon";
            } else if (
                row.MHRSCONF == "y" &&
                row.MATCONS == "y" &&
                row.STATUS != "DONE"
            ) {
                return "crowwteco";
            }
            //console.log(row);
        },

        permissionHandler: function() {
            this.grant_access = false;
            this.cust_access = false;
            this.dfp_access = false;

            if (this.datatable.specificColumns.REVNR.length) {
                for (const _revnr of this.datatable.specificColumns.REVNR) {
                    if (
                        this.$bulkCan(
                            "pc_hangar_tracking_system_edit",
                            "pc_hangar_tracking_system_edit_jc_mdr"
                        )
                    ) {
                        this.grant_access = true;
                    }
                    if (this.$can("pc_hangar_tracking_system_customer_edit")) {
                        this.cust_access = true;
                    }
                    if (this.$can("pc_hangar_tracking_system_edit_dfp")) {
                        this.dfp_access = true;
                    }
                    const info = this.datatable.specificColumns.PG.filter(
                        v => v.pg_id == _revnr
                    )[0];
                    

                    if (_revnr == info.pg_id) {
                        const getStartEndDate = obj => {
                            let objNew = Object.assign(
                                {},
                                {
                                    start_date: obj.start_date,
                                    end_date: obj.end_date
                                }
                            );

                            if (obj.end_date_new) {
                                return Object.assign({}, objNew, {
                                    ...objNew,
                                    end_date: obj.end_date_new
                                });
                            } else {
                                return objNew;
                            }
                        };

                        const { start_date, end_date } = getStartEndDate(info);

                        function getDates(startDate, stopDate) {
                            var dateArray = [];
                            var currentDate = moment(startDate);
                            var stopDate = moment(stopDate);
                            while (currentDate <= stopDate) {
                                dateArray.push(
                                    moment(currentDate).format("YYYY-MM-DD")
                                );
                                currentDate = moment(currentDate).add(
                                    1,
                                    "days"
                                );
                            }
                            return dateArray;
                        }

                        const arrDay = [];

                        let objForDayColumn = {
                            date_plan: getDates(start_date, end_date),
                            shift: [1, 2],
                            type: ["Cabin", "System", "Structure"]
                        };

                        const permForDayColumn = [
                            {
                                type: "Cabin",
                                permission:
                                    "gantt_chart_view_edit_manpowercabin"
                            },
                            {
                                type: "System",
                                permission:
                                    "gantt_chart_view_edit_manpowersystem"
                            },
                            {
                                type: "Structure",
                                permission:
                                    "gantt_chart_view_edit_manpowerstructure"
                            }
                        ];

                        for (const i of permForDayColumn) {
                            if (!this.$can(i.permission)) {
                                const idx = objForDayColumn.type.indexOf(
                                    i.type
                                );
                                objForDayColumn.type.splice(idx, 1);
                            }
                        }

                        objForDayColumn.date_plan.forEach((a, iii) => {
                            objForDayColumn.type.forEach((b, i) => {
                                objForDayColumn.shift.forEach((c, ii) => {
                                    arrDay.push({
                                        label: `Day : ${iii +
                                            1}, Type : ${b}, Shift : ${c}`,
                                        value: {
                                            date_plan: a,
                                            shift: c,
                                            type: b
                                        }
                                    });
                                });
                            });
                        });

                        arrDay.sort(function(a, b) {
                            b.value.type - a.value.type;
                        });

                        this.optionsDay = arrDay;
                        this.optionsDays.set(`${info.ac_reg}`, {
                            days: arrDay
                        });

                    }
                }
            }

            if (this.user.role.is_customer === "y") {
                this.is_cust = true;
            }
        },

        addTag: function(newTag) {
            this.options_order.push({ AUFNR: newTag });
        },

        addTagf: function(newTag) {
            this.options_finding.push({ AUFNR: newTag });
        },

        clearfilterorder: function() {
            this.datatable.serverParams.filter.order = [];
        },

        clearfilterAC_REG: function() {
            this.datatable.serverParams.filter.AC_REG = [];
        },

        initfilterOrder: function() {
            return new Promise((resolve, reject) => {
                axios
                    .get(
                        `/api/production_control_hangar/get_list_active_order_job/${this.$route.params.pg_id}`
                    )
                    .then(res => {
                        this.options_order = res.data;
                        resolve();
                    })
                    .catch(e => {
                        console.log("Error: " + e);
                        reject();
                    });
            });
        },

        filterscanneddfp: function() {
            this.clearfilterorder();
            if (this.multiselectfilteroption == "scan") {
                if (!this.options_order.length > 0) {
                    this.initfilterOrder().then(() => {
                        this.options_order.forEach(
                            this.matchindexdfp_add_to_orderfilter
                        );
                    });
                } else {
                    this.options_order.forEach(
                        this.matchindexdfp_add_to_orderfilter
                    );
                }
            } else if (this.multiselectfilteroption == "unscan") {
                if (!this.options_order.length > 0) {
                    this.initfilterOrder().then(() => {
                        this.options_order.forEach(
                            this.excindexdfp_add_to_orderfilter
                        );
                    });
                } else {
                    this.options_order.forEach(
                        this.excindexdfp_add_to_orderfilter
                    );
                }
            } else {
                this.loadItems();
            }
        },

        selectionChanged(params) {
            this.datatable.selectedRows = [];
            this.dataplanslip.selectedorder = [];
            this.dataplanslip.selectedsequence = [];
            for (let i = 0; i < params.selectedRows.length; i++) {
                this.datatable.selectedRows.push(params.selectedRows[i].ID);
                this.dataplanslip.selectedorder.push(
                    params.selectedRows[i].AUFNR
                );
                this.dataplanslip.selectedsequence.push(
                    params.selectedRows[i].SEQ_SWIFT == "" ||
                        params.selectedRows[i].SEQ_SWIFT == null
                        ? params.selectedRows[i].SEQ
                        : params.selectedRows[i].SEQ_SWIFT
                );
            }
        },

        handleUpdateStatus: function() {
            if (this.datatable.selectedRows.length < 1 || !this.grant_access)
                return;
            if (this.track_status === "") {
                toastr.warning("Please select status !");
                return;
            }

            toastr.info("Updating data ...");
            axios
                .post("/api/production_control_hangar/bulk_update_status", {
                    data: this.datatable.selectedRows,
                    status: this.track_status,
                    type: "JOBCARD"
                })
                .then(res => {
                    if (res.data.success) {
                        toastr.success(res.data.message);
                        this.track_status = "";
                        this.handlerAfterUpdate();
                    } else {
                        toastr.remove();
                        toastr.error(res.data.message);
                    }
                })
                .catch(e => {});
        },

        handleUpdatePosition: function() {
            if (this.datatable.selectedRows.length < 1 || !this.grant_access)
                return;
            if (this.update_positions === "") {
                toastr.warning("Please select position !");
                return;
            }

            toastr.info("Updating data ...");
            axios
                .post("/api/production_control_hangar/bulk_update_position", {
                    data: this.datatable.selectedRows,
                    status: this.update_positions,
                    type: "JOBCARD"
                })
                .then(res => {
                    if (res.data.success) {
                        toastr.success(res.data.message);
                        this.update_positions = "";
                        this.handlerAfterUpdate();
                    } else {
                        toastr.remove();
                        toastr.error(res.data.message);
                    }
                })
                .catch(e => {});
        },

        handleUpdateDFP: function() {
            if (this.datatable.selectedRows.length < 1 || !this.dfp_access)
                return;
            if (this.update_dfp === "") {
                toastr.warning("Please select DFP Status !");
                return;
            }
            if (this.update_dfp == "FINDING" && this.findingcateg.length == 0) {
                toastr.warning("Choose category of finding first !");
                return;
            }

            toastr.info("Updating data ...");
            axios
                .post("/api/production_control_hangar/bulk_update_dfp", {
                    data: this.datatable.selectedRows,
                    status: this.update_dfp,
                    finding: this.findingcateg,
                    dfpremark: this.dfpremark,
                    type: "JOBCARD"
                })
                .then(res => {
                    if (res.data.success) {
                        toastr.success(res.data.message);
                        this.update_dfp = "";
                        this.findingcateg = [];
                        this.dfpremark = "";
                        this.handlerAfterUpdate();
                    } else {
                        toastr.remove();
                        toastr.error(res.data.message);
                    }
                })
                .catch(e => {});
        },

        handlerAfterUpdate: function() {
            toastr.info("refreshing data ...");
            this.datatable.serverParams.searchTerm = "";

            axios
                .post(
                    "/api/production_control_hangar/get_tjobcardall",
                    Object.assign(
                        {},
                        {
                            ...this.datatable.serverParams,
                            revnr: this.datatable.specificColumns.REVNR
                        }
                    )
                )
                .then(res => {
                    this.datatable.rows = res.data.DB.data;
                    this.datatable.specificColumns = Object.assign(
                        {},
                        this.datatable.specificColumns,
                        { REVNR: res.data.REVNR, AC_REG: res.data.AC_REG }
                    );
                    this.datatable.totalRows = res.data.DB.total;
                    toastr.remove();
                    toastr.success("data refreshed");
                })
                .catch(e => {
                    console.log("Error: " + e);
                    toastr.remove();
                    toastr.error("Undefined error");
                });
        },

        handlerValidateSeqSwift: function(str) {
            if (str === "") return true;

            return /^\d+\.\d+$/.test(str);
        },

        handlerModalTimeline: function(data_id) {
            this.handlerTimeline(data_id).then(() => {
                $("#modal-timeline").modal("show");
            });
        },

        handlerTimeline: function(data_id) {
            return new Promise((resolve, reject) => {
                this.timelines = [];
                axios
                    .get(
                        `/api/tracking_log/get_timeline_jcmdr/${data_id}/` +
                            this.$route.params.pg_id
                    )
                    .then(res => {
                        this.timelines = res.data;
                        resolve();
                    })
                    .catch(e => {
                        toastr.error("Failed get timeline data");
                        reject();
                    });
            });
        },

        handlergetdfp: function(url) {
            if (this.dfpfolder == "" || this.dfpfolder == null) {
                this.dfp_url = [];
                //this.datatable.rows.forEach(this.matchindexdfp);
                return;
            }
            toastr.info("Connecting to Sharepoint DFP folder ...");
            axios
                .post("/api/production_control_hangar/connectdfp", {
                    urlfolder: url
                })
                .then(res => {
                    this.dfp_url = res.data.data;
                    this.datatable.rows.forEach(this.matchindexdfp);
                    toastr.remove();
                    toastr.success("DFP folder connected");
                    //console.log(res.data.data);
                    //this.datatable.rows[0].AUFNR = 'XXXXXXXX';
                    //this.datatable.rows.map(({'AUFNR'}) => ({'AUFNR'}));
                    //var el = this.dfp_url.find(a =>a.includes(this.datatable.rows[0].AUFNR));
                    //console.log(el);
                    //console.log(this.datatable.rows.map(({AUFNR}) => ({AUFNR})));
                    // = FieldJobcard.map((l) => Object.assign({}, l));
                })
                .catch(e => {
                    console.log("Error: " + e);
                    toastr.remove();
                    toastr.error("Undefined error");
                });
        },

        matchindexdfp: function(item, index) {
            $("#dfp-link-button-" + index)
                .removeAttr("href")
                .removeAttr("class");
            let url = this.dfp_url.find(a =>
                a.includes("(" + item.AUFNR + ")")
            );
            //console.log(this.dfp_url.find(a =>a.includes('('+item.AUFNR+')')));
            if (url != null) {
                $("#dfp-link-button-" + index)
                    .attr("href", url)
                    .addClass("status-handler success");
                //this.filterdfp_scanned.push(item.AUFNR);
                console.log(item.AUFNR);
            }
            //$('#dfp-link-button-'+index).attr('href',url);

            //this.datatable.rows[index].DFPURL = this.dfp_url.find(a =>a.includes('('+item.AUFNR+')'));
            //console.log(index);
        },

        matchindexdfp_add_to_orderfilter: function(item, index, array) {
            let url = this.dfp_url.find(a =>
                a.includes("(" + item.AUFNR + ")")
            );
            if (url != null) {
                this.datatable.serverParams.filter.order.push(item);
            }
            if (index == array.length - 1) {
                this.loadItems();
            }
        },

        excindexdfp_add_to_orderfilter: function(item, index, array) {
            let url = this.dfp_url.find(a =>
                a.includes("(" + item.AUFNR + ")")
            );
            if (url == null) {
                this.datatable.serverParams.filter.order.push(item);
            }
            if (index == array.length - 1) {
                this.loadItems();
            }
        },

        matchindexdfp_forexport: function(item) {
            let url = this.dfp_url.find(a =>
                a.includes("(" + item["Order No"] + ")")
            );
            //let url = this.dfp_url.find(a =>a.includes('('+item.AUFNR+')'));
            if (url != null) {
                item.DFP_URL = url;
            } else {
                item.DFP_URL = null;
            }
        }
    }
};
</script>
